{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/api/auth/session/route.js"],"sourcesContent":["// src/app/api/auth/session/route.js\n\nimport { NextResponse } from 'next/server';\nimport { getAuth } from 'firebase-admin/auth'; // Importación corregida\nimport { cookies } from 'next/headers';\nimport { initializeApp, getApps, cert } from 'firebase-admin/app'; // Necesario para inicializar\n\n// Duración de la cookie de sesión (5 días en segundos)\nconst expiresIn = 60 * 60 * 24 * 5;\n\n// Inicialización del SDK de Admin (solo se ejecuta una vez)\nconst serviceAccount = JSON.parse(process.env.FIREBASE_SERVICE_ACCOUNT_KEY || '{}');\n\nif (!getApps().length) {\n  initializeApp({\n    credential: cert(serviceAccount),\n  });\n}\n\n/**\n * Maneja la creación de la cookie de sesión (Login)\n */\nexport async function POST(request) {\n  const authorization = request.headers.get('Authorization');\n  if (!authorization?.startsWith('Bearer ')) {\n    return NextResponse.json({ error: 'Token no proporcionado.' }, { status: 401 });\n  }\n\n  const idToken = authorization.split('Bearer ')[1];\n\n  try {\n    // Usar getAuth() para acceder a los métodos de autenticación de admin\n    const sessionCookie = await getAuth().createSessionCookie(idToken, { expiresIn: expiresIn * 1000 });\n\n    // Establecer la cookie de forma segura\n    cookies().set('__session', sessionCookie, {\n      maxAge: expiresIn, \n      httpOnly: true,\n      secure: process.env.NODE_ENV === 'production',\n      path: '/',\n      sameSite: 'lax',\n    });\n\n    return NextResponse.json({ status: 'success' }, { status: 200 });\n\n  } catch (error) {\n    console.error('Error al crear la cookie de sesión:', error);\n    return NextResponse.json({ error: 'Autenticación fallida.' }, { status: 401 });\n  }\n}\n\n/**\n * Maneja la eliminación de la cookie de sesión (Logout)\n */\nexport async function DELETE(request) {\n  // Borrar la cookie\n  cookies().set('__session', '', {\n    maxAge: -1, \n    path: '/',\n  });\n\n  return NextResponse.json({ status: 'success' }, { status: 200 });\n}\n"],"names":[],"mappings":"AAAA,oCAAoC;;;;;;;AAEpC;AACA,kQAA+C,wBAAwB;AACvE;AACA,8PAAmE,6BAA6B;;;;;;;;;;AAEhG,uDAAuD;AACvD,MAAM,YAAY,KAAK,KAAK,KAAK;AAEjC,4DAA4D;AAC5D,MAAM,iBAAiB,KAAK,KAAK,CAAC,QAAQ,GAAG,CAAC,4BAA4B,IAAI;AAE9E,IAAI,CAAC,IAAA,2JAAO,IAAG,MAAM,EAAE;IACrB,IAAA,iKAAa,EAAC;QACZ,YAAY,IAAA,wJAAI,EAAC;IACnB;AACF;AAKO,eAAe,KAAK,OAAO;IAChC,MAAM,gBAAgB,QAAQ,OAAO,CAAC,GAAG,CAAC;IAC1C,IAAI,CAAC,eAAe,WAAW,YAAY;QACzC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;IAC/E;IAEA,MAAM,UAAU,cAAc,KAAK,CAAC,UAAU,CAAC,EAAE;IAEjD,IAAI;QACF,sEAAsE;QACtE,MAAM,gBAAgB,MAAM,IAAA,6JAAO,IAAG,mBAAmB,CAAC,SAAS;YAAE,WAAW,YAAY;QAAK;QAEjG,uCAAuC;QACvC,IAAA,4IAAO,IAAG,GAAG,CAAC,aAAa,eAAe;YACxC,QAAQ;YACR,UAAU;YACV,QAAQ,oDAAyB;YACjC,MAAM;YACN,UAAU;QACZ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,QAAQ;QAAU,GAAG;YAAE,QAAQ;QAAI;IAEhE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uCAAuC;QACrD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF;AAKO,eAAe,OAAO,OAAO;IAClC,mBAAmB;IACnB,IAAA,4IAAO,IAAG,GAAG,CAAC,aAAa,IAAI;QAC7B,QAAQ,CAAC;QACT,MAAM;IACR;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,QAAQ;IAAU,GAAG;QAAE,QAAQ;IAAI;AAChE","debugId":null}}]
}