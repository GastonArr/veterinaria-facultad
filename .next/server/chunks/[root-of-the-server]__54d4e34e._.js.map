{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/lib/firebaseAdmin.js"],"sourcesContent":["// Historia de Usuario 5: Gestión de Roles de Usuario\n\nimport admin from 'firebase-admin';\n\n// Comprobación para asegurar que el código se ejecuta solo en el servidor.\nif (typeof window === 'undefined') {\n  if (!admin.apps.length) {\n    try {\n      // Para que el Admin SDK funcione en Vercel, necesita las credenciales de la cuenta de servicio.\n      // Estas deben ser almacenadas como una variable de entorno en el proyecto de Vercel.\n      const serviceAccount = JSON.parse(process.env.FIREBASE_SERVICE_ACCOUNT_KEY);\n\n      admin.initializeApp({\n        credential: admin.credential.cert(serviceAccount)\n      });\n\n      console.log('Firebase Admin SDK inicializado correctamente.');\n\n    } catch (error) {\n      // Este error es común si la variable de entorno no está configurada en Vercel.\n      console.error('ERROR AL INICIALIZAR FIREBASE ADMIN SDK:', error);\n      console.error('Asegúrate de haber configurado la variable de entorno FIREBASE_SERVICE_ACCOUNT_KEY en Vercel con el JSON de tu cuenta de servicio.');\n    }\n  }\n}\n\n/**\n * Verifica la cookie de sesión de Firebase y devuelve el UID del usuario.\n * @param {string} sessionCookie La cadena de la cookie de sesión.\n * @returns {Promise<string|null>} El UID del usuario o null si la cookie no es válida.\n */\nexport async function getUserIdFromSession(sessionCookie) {\n  if (!sessionCookie) {\n    return null;\n  }\n  try {\n    const decodedClaims = await admin.auth().verifySessionCookie(sessionCookie, false);\n    return decodedClaims.uid;\n  } catch (error) {\n    // Si el SDK no se inicializó, este error puede ocurrir.\n    if (error.code === 'auth/invalid-session-cookie') {\n         console.error(\"La cookie de sesión no es válida. Puede que haya expirado o el SDK de Admin no esté configurado correctamente.\")\n    } else {\n        console.error('Error al verificar la cookie de sesión:', error.code);\n    }\n    return null;\n  }\n}\n\n\nexport default admin;\n"],"names":[],"mappings":"AAAA,qDAAqD;;;;;;;AAErD;;AAEA,2EAA2E;AAC3E,wCAAmC;IACjC,IAAI,CAAC,sIAAK,CAAC,IAAI,CAAC,MAAM,EAAE;QACtB,IAAI;YACF,gGAAgG;YAChG,qFAAqF;YACrF,MAAM,iBAAiB,KAAK,KAAK,CAAC,QAAQ,GAAG,CAAC,4BAA4B;YAE1E,sIAAK,CAAC,aAAa,CAAC;gBAClB,YAAY,sIAAK,CAAC,UAAU,CAAC,IAAI,CAAC;YACpC;YAEA,QAAQ,GAAG,CAAC;QAEd,EAAE,OAAO,OAAO;YACd,+EAA+E;YAC/E,QAAQ,KAAK,CAAC,4CAA4C;YAC1D,QAAQ,KAAK,CAAC;QAChB;IACF;AACF;AAOO,eAAe,qBAAqB,aAAa;IACtD,IAAI,CAAC,eAAe;QAClB,OAAO;IACT;IACA,IAAI;QACF,MAAM,gBAAgB,MAAM,sIAAK,CAAC,IAAI,GAAG,mBAAmB,CAAC,eAAe;QAC5E,OAAO,cAAc,GAAG;IAC1B,EAAE,OAAO,OAAO;QACd,wDAAwD;QACxD,IAAI,MAAM,IAAI,KAAK,+BAA+B;YAC7C,QAAQ,KAAK,CAAC;QACnB,OAAO;YACH,QAAQ,KAAK,CAAC,2CAA2C,MAAM,IAAI;QACvE;QACA,OAAO;IACT;AACF;uCAGe,sIAAK","debugId":null}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/api/auth/session/route.js"],"sourcesContent":["// src/app/api/auth/session/route.js\n\nimport { NextResponse } from 'next/server';\nimport admin from '@/lib/firebaseAdmin';\nimport { cookies } from 'next/headers';\n\n// Duración de la cookie de sesión (5 días en segundos)\nconst expiresIn = 60 * 60 * 24 * 5;\n\n/**\n * Maneja la creación de la cookie de sesión (Login)\n */\nexport async function POST(request) {\n  const authorization = request.headers.get('Authorization');\n  if (!authorization?.startsWith('Bearer ')) {\n    return NextResponse.json({ error: 'Token no proporcionado.' }, { status: 401 });\n  }\n\n  const idToken = authorization.split('Bearer ')[1];\n\n  try {\n    // Verificar el token ID y crear la cookie de sesión\n    const decodedToken = await admin.auth().verifyIdToken(idToken);\n    \n    // El SDK de Admin debe estar inicializado para que esto funcione\n    const sessionCookie = await admin.auth().createSessionCookie(idToken, { expiresIn: expiresIn * 1000 });\n\n    // Establecer la cookie en el navegador\n    cookies().set('session', sessionCookie, {\n      maxAge: expiresIn, // Tiempo de vida de la cookie\n      httpOnly: true, // La cookie no es accesible desde el JavaScript del cliente\n      secure: process.env.NODE_ENV === 'production', // Solo enviar por HTTPS en producción\n      path: '/', // Disponible en todo el sitio\n      sameSite: 'lax', // Protección contra ataques CSRF\n    });\n\n    return NextResponse.json({ status: 'success' }, { status: 200 });\n\n  } catch (error) {\n    console.error('Error al crear la cookie de sesión:', error);\n    // Este error es crítico y a menudo apunta a un problema con la inicialización del Admin SDK\n    if (error.code === 'auth/argument-error' || error.message.includes('Firebase App is not an App')) {\n        return NextResponse.json({\n             error: 'El Admin SDK de Firebase no se ha inicializado correctamente en el servidor. Verifica las variables de entorno en Vercel.'\n             }, { status: 500 });\n    }\n    return NextResponse.json({ error: 'Autenticación fallida.' }, { status: 401 });\n  }\n}\n\n/**\n * Maneja la eliminación de la cookie de sesión (Logout)\n */\nexport async function DELETE(request) {\n  // Borrar la cookie estableciendo su tiempo de vida en el pasado\n  cookies().set('session', '', {\n    maxAge: -1, \n    path: '/',\n  });\n\n  return NextResponse.json({ status: 'success' }, { status: 200 });\n}\n"],"names":[],"mappings":"AAAA,oCAAoC;;;;;;;AAEpC;AACA;AACA;;;;AAEA,uDAAuD;AACvD,MAAM,YAAY,KAAK,KAAK,KAAK;AAK1B,eAAe,KAAK,OAAO;IAChC,MAAM,gBAAgB,QAAQ,OAAO,CAAC,GAAG,CAAC;IAC1C,IAAI,CAAC,eAAe,WAAW,YAAY;QACzC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;IAC/E;IAEA,MAAM,UAAU,cAAc,KAAK,CAAC,UAAU,CAAC,EAAE;IAEjD,IAAI;QACF,oDAAoD;QACpD,MAAM,eAAe,MAAM,wIAAK,CAAC,IAAI,GAAG,aAAa,CAAC;QAEtD,iEAAiE;QACjE,MAAM,gBAAgB,MAAM,wIAAK,CAAC,IAAI,GAAG,mBAAmB,CAAC,SAAS;YAAE,WAAW,YAAY;QAAK;QAEpG,uCAAuC;QACvC,IAAA,4IAAO,IAAG,GAAG,CAAC,WAAW,eAAe;YACtC,QAAQ;YACR,UAAU;YACV,QAAQ,oDAAyB;YACjC,MAAM;YACN,UAAU;QACZ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,QAAQ;QAAU,GAAG;YAAE,QAAQ;QAAI;IAEhE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uCAAuC;QACrD,4FAA4F;QAC5F,IAAI,MAAM,IAAI,KAAK,yBAAyB,MAAM,OAAO,CAAC,QAAQ,CAAC,+BAA+B;YAC9F,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACpB,OAAO;YACP,GAAG;gBAAE,QAAQ;YAAI;QAC1B;QACA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF;AAKO,eAAe,OAAO,OAAO;IAClC,gEAAgE;IAChE,IAAA,4IAAO,IAAG,GAAG,CAAC,WAAW,IAAI;QAC3B,QAAQ,CAAC;QACT,MAAM;IACR;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,QAAQ;IAAU,GAAG;QAAE,QAAQ;IAAI;AAChE","debugId":null}}]
}