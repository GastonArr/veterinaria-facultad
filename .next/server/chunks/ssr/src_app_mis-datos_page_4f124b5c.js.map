{"version":3,"sources":["turbopack:///[project]/src/app/mis-datos/page.js"],"sourcesContent":["\n'use client';\n\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useRouter } from 'next/navigation';\nimport { useEffect, useState } from 'react';\nimport { Toaster, toast } from 'react-hot-toast';\nimport { doc, getDoc } from 'firebase/firestore';\nimport { db } from '@/lib/firebase';\n\n// Componente reutilizable para los campos del formulario\nconst FormInput = ({ id, name, type, placeholder, value, onChange, required = true, label }) => (\n    <div className=\"mb-4\">\n        <label className=\"block text-gray-700 text-sm font-bold mb-2\" htmlFor={id}>{label}</label>\n        <input\n            className=\"shadow-sm appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            id={id} name={name} type={type} placeholder={placeholder} value={value}\n            onChange={onChange} required={required}\n        />\n    </div>\n);\n\nexport default function MisDatosPage() {\n    const { user, loading, changePassword } = useAuth(); // Importamos changePassword\n    const router = useRouter();\n    const [profileData, setProfileData] = useState(null);\n    const [profileLoading, setProfileLoading] = useState(true);\n\n    // Estado para el formulario de cambio de contraseña\n    const [passwordData, setPasswordData] = useState({\n        currentPassword: '',\n        newPassword: '',\n        confirmPassword: ''\n    });\n\n    useEffect(() => {\n        if (loading) return;\n        if (!user) {\n            router.push('/login');\n            return;\n        }\n\n        const fetchProfileData = async () => {\n            const userDocRef = doc(db, 'users', user.uid);\n            const userDocSnap = await getDoc(userDocRef);\n            if (userDocSnap.exists()) {\n                setProfileData(userDocSnap.data());\n            }\n            setProfileLoading(false);\n        };\n\n        fetchProfileData();\n    }, [user, loading, router]);\n\n    const handlePasswordChange = (e) => {\n        const { name, value } = e.target;\n        setPasswordData(prev => ({ ...prev, [name]: value }));\n    };\n\n    const handlePasswordSubmit = async (e) => {\n        e.preventDefault();\n        const { currentPassword, newPassword, confirmPassword } = passwordData;\n\n        if (newPassword !== confirmPassword) {\n            toast.error('La nueva contraseña y su confirmación no coinciden.');\n            return;\n        }\n\n        if (newPassword.length < 6) {\n            toast.error('La nueva contraseña debe tener al menos 6 caracteres.');\n            return;\n        }\n\n        const toastId = toast.loading('Cambiando contraseña...');\n\n        try {\n            await changePassword(currentPassword, newPassword);\n            toast.success('¡Contraseña actualizada con éxito!', { id: toastId });\n            // Limpiar los campos por seguridad\n            setPasswordData({ currentPassword: '', newPassword: '', confirmPassword: '' });\n        } catch (error) {\n            console.error(error);\n            if (error.code === 'auth/wrong-password') {\n                toast.error('La contraseña actual es incorrecta.', { id: toastId });\n            } else {\n                toast.error('Hubo un error al cambiar la contraseña.', { id: toastId });\n            }\n        }\n    };\n\n    if (loading || profileLoading) {\n        return (\n            <div className=\"flex justify-center items-center h-screen bg-gray-50\">\n                 <div className=\"loader\"></div>\n                 <style jsx>{`\n                    .loader {\n                        border: 4px solid #f3f3f3;\n                        border-top: 4px solid #3498db;\n                        border-radius: 50%;\n                        width: 40px;\n                        height: 40px;\n                        animation: spin 1s linear infinite;\n                    }\n                    @keyframes spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                `}</style>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"min-h-screen bg-gray-50 p-4 sm:p-6 lg:p-8\">\n            <Toaster position=\"bottom-center\" />\n            <div className=\"max-w-4xl mx-auto\">\n                <div className=\"bg-white shadow-lg rounded-2xl p-6 sm:p-8\">\n                    <h1 className=\"text-3xl font-bold text-gray-800 mb-8 border-b pb-4\">Mis Datos</h1>\n                    \n                    {profileData ? (\n                        <div className=\"space-y-4 text-gray-700 mb-10\">\n                           <p><strong>Nombre:</strong> {profileData.nombre} {profileData.apellido}</p>\n                           <p><strong>DNI:</strong> {profileData.dni}</p>\n                           <p><strong>Email:</strong> {user.email}</p>\n                           <p><strong>Dirección:</strong> {profileData.direccion}, {profileData.barrio}</p>\n                           <p><strong>Teléfono:</strong> {profileData.telefonoPrincipal}</p>\n                        </div>\n                    ) : (\n                        <p className=\"text-gray-600 mb-10\">No se encontraron datos de perfil adicionales.</p>\n                    )}\n                    \n                    <div className=\"mt-8 pt-8 border-t\">\n                        <h2 className=\"text-2xl font-bold text-gray-800 mb-6\">Cambiar Contraseña</h2>\n                        <form onSubmit={handlePasswordSubmit} className=\"max-w-md\">\n                            <FormInput id=\"currentPassword\" name=\"currentPassword\" type=\"password\" label=\"Contraseña Actual\" placeholder=\"••••••••••\" value={passwordData.currentPassword} onChange={handlePasswordChange} />\n                            <FormInput id=\"newPassword\" name=\"newPassword\" type=\"password\" label=\"Nueva Contraseña\" placeholder=\"Mínimo 6 caracteres\" value={passwordData.newPassword} onChange={handlePasswordChange} />\n                            <FormInput id=\"confirmPassword\" name=\"confirmPassword\" type=\"password\" label=\"Confirmar Nueva Contraseña\" placeholder=\"Repite la nueva contraseña\" value={passwordData.confirmPassword} onChange={handlePasswordChange} />\n                            <button type=\"submit\" className=\"w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:shadow-outline transition-transform transform hover:scale-105\">\n                                Guardar Cambios\n                            </button>\n                        </form>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}