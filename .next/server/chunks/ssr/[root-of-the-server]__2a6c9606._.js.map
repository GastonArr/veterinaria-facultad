{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/lib/firebaseAdmin.js"],"sourcesContent":["\nimport admin from 'firebase-admin';\n\n\nif (!admin.apps.length) {\n  try {\n    admin.initializeApp();\n  } catch (error) {\n    console.error('Error en la inicialización de Firebase Admin SDK:', error);\n  }\n}\n\n/**\n * Verifica la cookie de sesión de Firebase y devuelve el UID del usuario.\n * @param {string} sessionCookie La cadena de la cookie de sesión.\n * @returns {Promise<string|null>} El UID del usuario o null si la cookie no es válida.\n */\nexport async function getUserIdFromSession(sessionCookie) {\n  if (!sessionCookie) {\n    return null;\n  }\n  try {\n    const decodedClaims = await admin.auth().verifySessionCookie(sessionCookie, true);\n    return decodedClaims.uid;\n  } catch (error) {\n    console.error('Error al verificar la cookie de sesión:', error.code);\n    return null;\n  }\n}\n\n\nexport default admin;\n"],"names":[],"mappings":";;;;;;AACA;;AAGA,IAAI,CAAC,sIAAK,CAAC,IAAI,CAAC,MAAM,EAAE;IACtB,IAAI;QACF,sIAAK,CAAC,aAAa;IACrB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qDAAqD;IACrE;AACF;AAOO,eAAe,qBAAqB,aAAa;IACtD,IAAI,CAAC,eAAe;QAClB,OAAO;IACT;IACA,IAAI;QACF,MAAM,gBAAgB,MAAM,sIAAK,CAAC,IAAI,GAAG,mBAAmB,CAAC,eAAe;QAC5E,OAAO,cAAc,GAAG;IAC1B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2CAA2C,MAAM,IAAI;QACnE,OAAO;IACT;AACF;uCAGe,sIAAK","debugId":null}},
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/actions.js"],"sourcesContent":["\n'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport admin from '@/lib/firebaseAdmin';\n\nconst aplicationRoles = {\n  '00000001': 'admin',      // Magali - DNI sin puntos\n  '00000002': 'peluquera',\n  '00000003': 'transporte',\n};\n\nexport async function completarPerfil(userId, userData) {\n  const firestore = admin.firestore();\n  const auth = admin.auth();\n\n  // Campos que vienen del formulario de registro\n  const { \n    nombre, \n    apellido, \n    dni, \n    telefonoPrincipal, \n    telefonoSecundario, \n    direccion, \n    barrio, \n    nombreContactoEmergencia, \n    telefonoContactoEmergencia \n  } = userData;\n  \n  // Validación con los campos correctos\n  if (!userId || !nombre || !apellido || !dni || !telefonoPrincipal || !direccion || !barrio || !nombreContactoEmergencia || !telefonoContactoEmergencia) {\n    console.error('Validation failed. Missing data:', { userId, ...userData });\n    return { success: false, error: 'Faltan datos esenciales para completar el perfil.' };\n  }\n\n  try {\n    // Asignar rol. Si el DNI está en la lista, se le da un rol especial.\n    const userRole = aplicationRoles[dni] || 'dueño';\n\n    // 1. Asignar el \"custom claim\" para el rol de usuario en Authentication\n    await auth.setCustomUserClaims(userId, { role: userRole });\n\n    // 2. Guardar todos los datos del perfil en la base de datos Firestore\n    await firestore.collection('users').doc(userId).set({\n      nombre,\n      apellido,\n      dni,\n      telefonoPrincipal,\n      telefonoSecundario: telefonoSecundario || '', // Guardar aunque esté vacío\n      direccion,\n      barrio,\n      nombreContactoEmergencia,\n      telefonoContactoEmergencia,\n      role: userRole,\n      profileCompleted: true,\n      createdAt: admin.firestore.FieldValue.serverTimestamp(), // Buena práctica\n    }, { merge: true }); // Merge true para no sobrescribir datos si ya existía el doc.\n\n    // Invalidar caché para que los cambios se reflejen si es necesario\n    revalidatePath('/');\n    \n    return { success: true, role: userRole };\n\n  } catch (error) {\n    console.error('Error al completar el perfil en el servidor:', error);\n    // Devolver un error genérico para no exponer detalles de implementación\n    return { success: false, error: 'Ocurrió un error en el servidor al procesar tu perfil.' };\n  }\n}\n\n/**\n * Server Action para agregar una nueva mascota a un usuario.\n */\nexport async function agregarMascota(userId, mascotaData) {\n    if (!userId) {\n        return { success: false, error: 'Usuario no autenticado.' };\n    }\n\n    const { nombre, especie, raza, fechaNacimiento, tamaño, enAdopcion } = mascotaData;\n\n    if (!nombre || !especie || !raza || !fechaNacimiento || !tamaño) {\n        return { success: false, error: 'Todos los campos, incluyendo el tamaño, son obligatorios.' };\n    }\n\n    const firestore = admin.firestore();\n\n    try {\n        const mascotaRef = await firestore.collection('users').doc(userId).collection('mascotas').add({\n            nombre,\n            especie,\n            raza,\n            fechaNacimiento,\n            tamaño,\n            enAdopcion: enAdopcion || false, \n            createdAt: new Date(),\n        });\n\n        revalidatePath('/mascotas');\n\n        return { success: true, mascotaId: mascotaRef.id };\n\n    } catch (error) {\n        console.error('Error al agregar la mascota:', error);\n        return { success: false, error: 'No se pudo registrar la mascota en la base de datos.' };\n    }\n}\n"],"names":[],"mappings":";;;;;;;;AAGA;AACA;;;;;;AAEA,MAAM,kBAAkB;IACtB,YAAY;IACZ,YAAY;IACZ,YAAY;AACd;AAEO,eAAe,gBAAgB,MAAM,EAAE,QAAQ;IACpD,MAAM,YAAY,sIAAK,CAAC,SAAS;IACjC,MAAM,OAAO,sIAAK,CAAC,IAAI;IAEvB,+CAA+C;IAC/C,MAAM,EACJ,MAAM,EACN,QAAQ,EACR,GAAG,EACH,iBAAiB,EACjB,kBAAkB,EAClB,SAAS,EACT,MAAM,EACN,wBAAwB,EACxB,0BAA0B,EAC3B,GAAG;IAEJ,sCAAsC;IACtC,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,YAAY,CAAC,OAAO,CAAC,qBAAqB,CAAC,aAAa,CAAC,UAAU,CAAC,4BAA4B,CAAC,4BAA4B;QACtJ,QAAQ,KAAK,CAAC,oCAAoC;YAAE;YAAQ,GAAG,QAAQ;QAAC;QACxE,OAAO;YAAE,SAAS;YAAO,OAAO;QAAoD;IACtF;IAEA,IAAI;QACF,qEAAqE;QACrE,MAAM,WAAW,eAAe,CAAC,IAAI,IAAI;QAEzC,wEAAwE;QACxE,MAAM,KAAK,mBAAmB,CAAC,QAAQ;YAAE,MAAM;QAAS;QAExD,sEAAsE;QACtE,MAAM,UAAU,UAAU,CAAC,SAAS,GAAG,CAAC,QAAQ,GAAG,CAAC;YAClD;YACA;YACA;YACA;YACA,oBAAoB,sBAAsB;YAC1C;YACA;YACA;YACA;YACA,MAAM;YACN,kBAAkB;YAClB,WAAW,sIAAK,CAAC,SAAS,CAAC,UAAU,CAAC,eAAe;QACvD,GAAG;YAAE,OAAO;QAAK,IAAI,8DAA8D;QAEnF,mEAAmE;QACnE,IAAA,+IAAc,EAAC;QAEf,OAAO;YAAE,SAAS;YAAM,MAAM;QAAS;IAEzC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gDAAgD;QAC9D,wEAAwE;QACxE,OAAO;YAAE,SAAS;YAAO,OAAO;QAAyD;IAC3F;AACF;AAKO,eAAe,eAAe,MAAM,EAAE,WAAW;IACpD,IAAI,CAAC,QAAQ;QACT,OAAO;YAAE,SAAS;YAAO,OAAO;QAA0B;IAC9D;IAEA,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,eAAe,EAAE,MAAM,EAAE,UAAU,EAAE,GAAG;IAEvE,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,QAAQ,CAAC,mBAAmB,CAAC,QAAQ;QAC7D,OAAO;YAAE,SAAS;YAAO,OAAO;QAA4D;IAChG;IAEA,MAAM,YAAY,sIAAK,CAAC,SAAS;IAEjC,IAAI;QACA,MAAM,aAAa,MAAM,UAAU,UAAU,CAAC,SAAS,GAAG,CAAC,QAAQ,UAAU,CAAC,YAAY,GAAG,CAAC;YAC1F;YACA;YACA;YACA;YACA;YACA,YAAY,cAAc;YAC1B,WAAW,IAAI;QACnB;QAEA,IAAA,+IAAc,EAAC;QAEf,OAAO;YAAE,SAAS;YAAM,WAAW,WAAW,EAAE;QAAC;IAErD,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO;YAAE,SAAS;YAAO,OAAO;QAAuD;IAC3F;AACJ;;;IA7FsB;IA6DA;;AA7DA,+OAAA;AA6DA,+OAAA","debugId":null}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/actions/turnosActions.js"],"sourcesContent":["\n'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport admin from '@/lib/firebaseAdmin';\nimport { cookies } from 'next/headers';\nimport { getUserIdFromSession } from '@/lib/firebaseAdmin';\n\n// --- Lógica para Turnos de Peluquería ---\n\nconst MAX_PERROS_GRANDES_POR_DIA = 2;\nconst MAX_TURNOS_POR_TURNO_PELUQUERIA = 8;\n\nexport async function solicitarTurnoPeluqueria(turnoData) {\n    const { clienteId, mascotaId, fecha, turno, servicios, transporte, metodoPago } = turnoData;\n\n    if (!clienteId || !mascotaId || !fecha || !turno || !metodoPago) {\n        return { success: false, error: 'Faltan datos esenciales, incluido el método de pago.' };\n    }\n\n    const firestore = admin.firestore();\n\n    try {\n        const mascotaRef = firestore.collection('users').doc(clienteId).collection('mascotas').doc(mascotaId);\n        const mascotaSnap = await mascotaRef.get();\n\n        if (!mascotaSnap.exists) {\n            return { success: false, error: 'La mascota seleccionada no existe.' };\n        }\n        const tamañoMascota = mascotaSnap.data().tamaño;\n\n        const resultado = await firestore.runTransaction(async (transaction) => {\n            const turnosRef = firestore.collection('turnos');\n\n            if (tamañoMascota === 'grande') {\n                const qGrandes = turnosRef.where('fecha', '==', fecha).where('tipo', '==', 'peluqueria').where('tamañoMascota', '==', 'grande').where('estado', 'in', ['pendiente', 'confirmado']);\n                const snapGrandes = await transaction.get(qGrandes);\n                if (snapGrandes.docs.length >= MAX_PERROS_GRANDES_POR_DIA) {\n                    throw new Error('El cupo para perros grandes en esta fecha ya está completo.');\n                }\n            }\n            const qTurno = turnosRef.where('fecha', '==', fecha).where('turno', '==', turno).where('tipo', '==', 'peluqueria').where('estado', 'in', ['pendiente', 'confirmado']);\n            const snapTurno = await transaction.get(qTurno);\n            if (snapTurno.docs.length >= MAX_TURNOS_POR_TURNO_PELUQUERIA) {\n                throw new Error(`El turno de la ${turno} para esta fecha ya está completo.`);\n            }\n\n            const nuevoTurnoRef = firestore.collection('turnos').doc();\n            transaction.set(nuevoTurnoRef, {\n                ...turnoData,\n                tamañoMascota,\n                estado: 'pendiente',\n                createdAt: new Date().toISOString(),\n            });\n\n            return { success: true, turnoId: nuevoTurnoRef.id };\n        });\n\n        revalidatePath('/admin/turnos');\n        revalidatePath('/mis-turnos');\n        return resultado;\n\n    } catch (error) {\n        console.error('Error en la transacción de solicitud de turno de peluquería:', error);\n        return { success: false, error: error.message };\n    }\n}\n\n\n// --- Lógica para Turnos de Consulta ---\n\nexport async function solicitarTurnoConsulta(turnoData) {\n    // Añadimos 'metodoPago' a la desestructuración\n    const { clienteId, mascotaId, fecha, turno, motivo, metodoPago } = turnoData;\n\n    // Añadimos validación para el nuevo campo\n    if (!clienteId || !mascotaId || !fecha || !turno || !motivo || !metodoPago) {\n        return { success: false, error: 'Faltan datos esenciales, incluido el método de pago.' };\n    }\n\n    const firestore = admin.firestore();\n\n    try {\n        const nuevoTurnoRef = firestore.collection('turnos').doc();\n        \n        // El operador '...' se asegura de que 'metodoPago' se guarde en la BD\n        await nuevoTurnoRef.set({\n            ...turnoData,\n            tipo: 'consulta',\n            estado: 'pendiente',\n            createdAt: new Date().toISOString(),\n        });\n\n        revalidatePath('/admin/turnos');\n        revalidatePath('/mis-turnos');\n\n        return { success: true, turnoId: nuevoTurnoRef.id };\n\n    } catch (error) {\n        console.error('Error al solicitar el turno de consulta:', error);\n        return { success: false, error: 'Ocurrió un error inesperado al guardar la solicitud.' };\n    }\n}\n\n\n// --- LÓGICA DE CANCELACIÓN DE TURNO (PARA USUARIOS) ---\n\nexport async function cancelarTurnoUsuario(turnoId) {\n    const sessionCookie = cookies().get('__session')?.value || '';\n    const userId = await getUserIdFromSession(sessionCookie);\n\n    if (!userId) {\n        return { success: false, error: 'No estás autenticado.' };\n    }\n\n    if (!turnoId) {\n        return { success: false, error: 'No se proporcionó un ID de turno.' };\n    }\n\n    const firestore = admin.firestore();\n    const turnoRef = firestore.collection('turnos').doc(turnoId);\n\n    try {\n        const turnoSnap = await turnoRef.get();\n\n        if (!turnoSnap.exists) {\n            return { success: false, error: 'El turno no existe.' };\n        }\n\n        const turnoData = turnoSnap.data();\n\n        if (turnoData.clienteId !== userId) {\n            return { success: false, error: 'No tienes permiso para cancelar este turno.' };\n        }\n\n        if ([ 'cancelado', 'completado'].includes(turnoData.estado)) {\n            return { success: false, error: 'Este turno ya no se puede cancelar.' };\n        }\n\n        const hoy = new Date();\n        hoy.setHours(0, 0, 0, 0);\n        const fechaTurno = new Date(turnoData.fecha + 'T12:00:00'); \n\n        if (fechaTurno < hoy) {\n            return { success: false, error: 'No se puede cancelar un turno que ya ha pasado.' };\n        }\n\n        await turnoRef.update({\n            estado: 'cancelado',\n            canceladoAt: new Date().toISOString(),\n            canceladoPor: 'usuario'\n        });\n\n        revalidatePath('/mis-turnos');\n        revalidatePath('/admin/turnos');\n\n        return { success: true };\n\n    } catch (error) {\n        console.error('Error al cancelar el turno:', error);\n        return { success: false, error: 'Ocurrió un error inesperado al intentar cancelar el turno.' };\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 366, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/.next-internal/server/app/mis-turnos/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {completarPerfil as '6091545e0ff3735577794c80d201d16465bc00f7ee'} from 'ACTIONS_MODULE0'\nexport {cancelarTurnoUsuario as '4093a4aa03c2c59627713abff7895576bb00a12544'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AACA","debugId":null}},
    {"offset": {"line": 404, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/PrivateRoute.js/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/components/PrivateRoute.js <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/components/PrivateRoute.js <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAsS,GACnU,oEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 418, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/PrivateRoute.js/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/components/PrivateRoute.js from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/components/PrivateRoute.js\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAkR,GAC/S,gDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 432, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 440, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/AccionesTurnoUsuario.jsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/components/AccionesTurnoUsuario.jsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/components/AccionesTurnoUsuario.jsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA+S,GAC5U,6EACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 454, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/AccionesTurnoUsuario.jsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/components/AccionesTurnoUsuario.jsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/components/AccionesTurnoUsuario.jsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA2R,GACxT,yDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 468, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 476, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/mis-turnos/page.js"],"sourcesContent":["\nimport { cookies } from 'next/headers';\nimport { redirect } from 'next/navigation';\nimport admin from '@/lib/firebaseAdmin';\nimport { getUserIdFromSession } from '@/lib/firebaseAdmin';\nimport PrivateRoute from '@/app/components/PrivateRoute';\nimport Footer from '@/app/components/Footer';\nimport AccionesTurnoUsuario from '@/app/components/AccionesTurnoUsuario';\nimport { FiClock, FiCheckCircle, FiXCircle, FiCalendar, FiSun, FiMoon, FiScissors } from 'react-icons/fi';\n\nasync function getUserTurnos(userId) {\n    if (!userId) return [];\n    const firestore = admin.firestore();\n    try {\n        // CORRECCIÓN: Se cambia 'userId' por 'clienteId' para que coincida con el campo guardado en la BD.\n        const turnosSnap = await firestore.collection('turnos').where('clienteId', '==', userId).get();\n        if (turnosSnap.empty) return [];\n\n        const turnosData = turnosSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n        // Ordenar por fecha del turno descendente\n        turnosData.sort((a, b) => (new Date(b.fecha)) - (new Date(a.fecha)));\n\n        const turnosEnriquecidos = await Promise.all(turnosData.map(async (turno) => {\n            let mascotaNombre = 'Mascota desconocida';\n            if (turno.mascotaId) {\n                // Usamos el clienteId del turno para buscar la mascota, es más seguro\n                const mascotaSnap = await firestore.collection('users').doc(turno.clienteId).collection('mascotas').doc(turno.mascotaId).get();\n                if (mascotaSnap.exists) {\n                    mascotaNombre = mascotaSnap.data().nombre;\n                }\n            }\n            return {\n                ...turno,\n                mascotaNombre,\n                fechaFormateada: new Date(turno.fecha + 'T12:00:00').toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' })\n            };\n        }));\n        return turnosEnriquecidos;\n    } catch (error) {\n        console.error(\"Error al obtener los turnos en el servidor:\", error);\n        return [];\n    }\n}\n\nfunction EstadoBadge({ estado }) {\n    const baseClasses = \"px-3 py-1 text-sm font-semibold rounded-full inline-flex items-center shadow-sm\";\n    const styles = {\n        pendiente: { icon: <FiClock className=\"mr-2\" />, classes: \"bg-yellow-100 text-yellow-800\" },\n        confirmado: { icon: <FiCheckCircle className=\"mr-2\" />, classes: \"bg-green-100 text-green-800\" },\n        cancelado: { icon: <FiXCircle className=\"mr-2\" />, classes: \"bg-red-100 text-red-800\" },\n        completado: { icon: <FiCheckCircle className=\"mr-2\" />, classes: \"bg-blue-100 text-blue-800\" },\n    };\n    const style = styles[estado?.toLowerCase()] || styles.pendiente;\n\n    return (\n        <div className={`${baseClasses} ${style.classes}`}>\n            {style.icon}\n            {estado ? estado.charAt(0).toUpperCase() + estado.slice(1) : 'Pendiente'}\n        </div>\n    );\n}\n\nexport default async function MisTurnosPage() {\n    const sessionCookie = cookies().get('__session')?.value || '';\n    const userId = await getUserIdFromSession(sessionCookie);\n\n    if (!userId) {\n        redirect('/login');\n    }\n\n    const turnos = await getUserTurnos(userId);\n\n    return (\n        <PrivateRoute>\n            <main className=\"min-h-screen bg-gradient-to-b from-gray-50 to-gray-100\">\n                <div className=\"container mx-auto px-4 py-12\">\n                    <h1 className=\"text-4xl font-extrabold text-center mb-12 text-gray-800\">Mis Turnos</h1>\n                    {turnos.length === 0 ? (\n                        <div className=\"text-center bg-white p-12 rounded-2xl shadow-lg border border-gray-100\">\n                            <FiCalendar className=\"mx-auto text-6xl text-violet-300 mb-4\"/>\n                            <h2 className=\"text-2xl font-semibold text-gray-700 mb-2\">Sin Turnos Solicitados</h2>\n                            <p className=\"text-gray-500 mb-6\">Parece que tus mascotas aún no tienen citas. ¡Vamos a solucionarlo!</p>\n                            <a href=\"/\" className=\"mt-6 inline-block bg-violet-600 text-white font-bold py-3 px-8 rounded-full hover:bg-violet-700 transition-all duration-300 transform hover:scale-105\">\n                                Pedir un Turno\n                            </a>\n                        </div>\n                    ) : (\n                        <div className=\"space-y-6\">\n                            {turnos.map(turno => (\n                                <div key={turno.id} className={`bg-white p-6 rounded-2xl shadow-lg border border-gray-200/80 transition-opacity duration-500 ${turno.estado === 'cancelado' ? 'opacity-60' : ''}`}>\n                                    <div className=\"flex flex-col sm:flex-row justify-between\">\n                                        <div className=\"flex-grow mb-4 sm:mb-0\">\n                                            <div className=\"flex items-center mb-3\">\n                                                <h2 className=\"text-2xl font-bold text-gray-900 mr-4\">{turno.mascotaNombre}</h2>\n                                                <EstadoBadge estado={turno.estado} />\n                                            </div>\n                                            <div className=\"text-sm text-gray-600 space-y-2 pl-1\">\n                                                <p className=\"flex items-center\"><FiCalendar className=\"mr-3 text-violet-500\" /> {turno.fechaFormateada}</p>\n                                                <p className=\"flex items-center capitalize\">\n                                                    {turno.turno === 'manana' ? <FiSun className=\"mr-3 text-yellow-500\"/> : <FiMoon className=\"mr-3 text-blue-500\"/>} \n                                                    Turno {turno.turno}\n                                                </p>\n                                                {turno.servicios && turno.servicios.length > 0 && (\n                                                    <p className=\"flex items-center capitalize\">\n                                                        <FiScissors className=\"mr-3 text-gray-500\"/> \n                                                        Servicios: {turno.servicios.join(', ')}\n                                                    </p>\n                                                )}\n                                            </div>\n                                        </div>\n                                        <AccionesTurnoUsuario turno={turno} />\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    )}\n                </div>\n            </main>\n            <Footer />\n        </PrivateRoute>\n    );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}