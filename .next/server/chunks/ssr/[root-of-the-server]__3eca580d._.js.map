{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/lib/firebaseAdmin.js"],"sourcesContent":["// Historia de Usuario 5: Gestión de Roles de Usuario\n\nimport admin from 'firebase-admin';\n\n// Comprobación para asegurar que el código se ejecuta solo en el servidor.\nif (typeof window === 'undefined') {\n  if (!admin.apps.length) {\n    try {\n      // Para que el Admin SDK funcione en Vercel, necesita las credenciales de la cuenta de servicio.\n      // Estas deben ser almacenadas como una variable de entorno en el proyecto de Vercel.\n      const serviceAccount = JSON.parse(process.env.FIREBASE_SERVICE_ACCOUNT_KEY);\n\n      admin.initializeApp({\n        credential: admin.credential.cert(serviceAccount)\n      });\n\n      console.log('Firebase Admin SDK inicializado correctamente.');\n\n    } catch (error) {\n      // Este error es común si la variable de entorno no está configurada en Vercel.\n      console.error('ERROR AL INICIALIZAR FIREBASE ADMIN SDK:', error);\n      console.error('Asegúrate de haber configurado la variable de entorno FIREBASE_SERVICE_ACCOUNT_KEY en Vercel con el JSON de tu cuenta de servicio.');\n    }\n  }\n}\n\n/**\n * Verifica la cookie de sesión de Firebase y devuelve el UID del usuario.\n * @param {string} sessionCookie La cadena de la cookie de sesión.\n * @returns {Promise<string|null>} El UID del usuario o null si la cookie no es válida.\n */\nexport async function getUserIdFromSession(sessionCookie) {\n  if (!sessionCookie) {\n    return null;\n  }\n  try {\n    const decodedClaims = await admin.auth().verifySessionCookie(sessionCookie, false);\n    return decodedClaims.uid;\n  } catch (error) {\n    // Si el SDK no se inicializó, este error puede ocurrir.\n    if (error.code === 'auth/invalid-session-cookie') {\n         console.error(\"La cookie de sesión no es válida. Puede que haya expirado o el SDK de Admin no esté configurado correctamente.\")\n    } else {\n        console.error('Error al verificar la cookie de sesión:', error.code);\n    }\n    return null;\n  }\n}\n\n\nexport default admin;\n"],"names":[],"mappings":"AAAA,qDAAqD;;;;;;;AAErD;;AAEA,2EAA2E;AAC3E,wCAAmC;IACjC,IAAI,CAAC,sIAAK,CAAC,IAAI,CAAC,MAAM,EAAE;QACtB,IAAI;YACF,gGAAgG;YAChG,qFAAqF;YACrF,MAAM,iBAAiB,KAAK,KAAK,CAAC,QAAQ,GAAG,CAAC,4BAA4B;YAE1E,sIAAK,CAAC,aAAa,CAAC;gBAClB,YAAY,sIAAK,CAAC,UAAU,CAAC,IAAI,CAAC;YACpC;YAEA,QAAQ,GAAG,CAAC;QAEd,EAAE,OAAO,OAAO;YACd,+EAA+E;YAC/E,QAAQ,KAAK,CAAC,4CAA4C;YAC1D,QAAQ,KAAK,CAAC;QAChB;IACF;AACF;AAOO,eAAe,qBAAqB,aAAa;IACtD,IAAI,CAAC,eAAe;QAClB,OAAO;IACT;IACA,IAAI;QACF,MAAM,gBAAgB,MAAM,sIAAK,CAAC,IAAI,GAAG,mBAAmB,CAAC,eAAe;QAC5E,OAAO,cAAc,GAAG;IAC1B,EAAE,OAAO,OAAO;QACd,wDAAwD;QACxD,IAAI,MAAM,IAAI,KAAK,+BAA+B;YAC7C,QAAQ,KAAK,CAAC;QACnB,OAAO;YACH,QAAQ,KAAK,CAAC,2CAA2C,MAAM,IAAI;QACvE;QACA,OAAO;IACT;AACF;uCAGe,sIAAK","debugId":null}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/actions/turnosActions.js"],"sourcesContent":["\n'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport admin from '@/lib/firebaseAdmin';\nimport { cookies } from 'next/headers';\nimport { getUserIdFromSession } from '@/lib/firebaseAdmin';\n\n// --- Lógica para Turnos de Peluquería ---\n\nconst MAX_PERROS_GRANDES_POR_DIA = 2;\nconst MAX_TURNOS_POR_TURNO_PELUQUERIA = 8;\n\nexport async function solicitarTurnoPeluqueria(turnoData) {\n    const { clienteId, mascotaId, fecha, turno, servicios, transporte, metodoPago } = turnoData;\n\n    if (!clienteId || !mascotaId || !fecha || !turno || !metodoPago) {\n        return { success: false, error: 'Faltan datos esenciales, incluido el método de pago.' };\n    }\n\n    const firestore = admin.firestore();\n\n    try {\n        const mascotaRef = firestore.collection('users').doc(clienteId).collection('mascotas').doc(mascotaId);\n        const mascotaSnap = await mascotaRef.get();\n\n        if (!mascotaSnap.exists) {\n            return { success: false, error: 'La mascota seleccionada no existe.' };\n        }\n        const tamañoMascota = mascotaSnap.data().tamaño;\n\n        const resultado = await firestore.runTransaction(async (transaction) => {\n            const turnosRef = firestore.collection('turnos');\n\n            if (tamañoMascota === 'grande') {\n                const qGrandes = turnosRef.where('fecha', '==', fecha).where('tipo', '==', 'peluqueria').where('tamañoMascota', '==', 'grande').where('estado', 'in', ['pendiente', 'confirmado']);\n                const snapGrandes = await transaction.get(qGrandes);\n                if (snapGrandes.docs.length >= MAX_PERROS_GRANDES_POR_DIA) {\n                    throw new Error('El cupo para perros grandes en esta fecha ya está completo.');\n                }\n            }\n            const qTurno = turnosRef.where('fecha', '==', fecha).where('turno', '==', turno).where('tipo', '==', 'peluqueria').where('estado', 'in', ['pendiente', 'confirmado']);\n            const snapTurno = await transaction.get(qTurno);\n            if (snapTurno.docs.length >= MAX_TURNOS_POR_TURNO_PELUQUERIA) {\n                throw new Error(`El turno de la ${turno} para esta fecha ya está completo.`);\n            }\n\n            const nuevoTurnoRef = firestore.collection('turnos').doc();\n            transaction.set(nuevoTurnoRef, {\n                ...turnoData,\n                tamañoMascota,\n                estado: 'pendiente',\n                createdAt: new Date().toISOString(),\n            });\n\n            return { success: true, turnoId: nuevoTurnoRef.id };\n        });\n\n        revalidatePath('/admin/turnos');\n        revalidatePath('/mis-turnos');\n        return resultado;\n\n    } catch (error) {\n        console.error('Error en la transacción de solicitud de turno de peluquería:', error);\n        return { success: false, error: error.message };\n    }\n}\n\n\n// --- Lógica para Turnos de Consulta ---\n\nexport async function solicitarTurnoConsulta(turnoData) {\n    // Añadimos 'metodoPago' a la desestructuración\n    const { clienteId, mascotaId, fecha, turno, motivo, metodoPago } = turnoData;\n\n    // Añadimos validación para el nuevo campo\n    if (!clienteId || !mascotaId || !fecha || !turno || !motivo || !metodoPago) {\n        return { success: false, error: 'Faltan datos esenciales, incluido el método de pago.' };\n    }\n\n    const firestore = admin.firestore();\n\n    try {\n        const nuevoTurnoRef = firestore.collection('turnos').doc();\n        \n        // El operador '...' se asegura de que 'metodoPago' se guarde en la BD\n        await nuevoTurnoRef.set({\n            ...turnoData,\n            tipo: 'consulta',\n            estado: 'pendiente',\n            createdAt: new Date().toISOString(),\n        });\n\n        revalidatePath('/admin/turnos');\n        revalidatePath('/mis-turnos');\n\n        return { success: true, turnoId: nuevoTurnoRef.id };\n\n    } catch (error) {\n        console.error('Error al solicitar el turno de consulta:', error);\n        return { success: false, error: 'Ocurrió un error inesperado al guardar la solicitud.' };\n    }\n}\n\n\n// --- LÓGICA DE CANCELACIÓN DE TURNO (PARA USUARIOS) ---\n\nexport async function cancelarTurnoUsuario(turnoId) {\n    const sessionCookie = cookies().get('__session')?.value || '';\n    const userId = await getUserIdFromSession(sessionCookie);\n\n    if (!userId) {\n        return { success: false, error: 'No estás autenticado.' };\n    }\n\n    if (!turnoId) {\n        return { success: false, error: 'No se proporcionó un ID de turno.' };\n    }\n\n    const firestore = admin.firestore();\n    const turnoRef = firestore.collection('turnos').doc(turnoId);\n\n    try {\n        const turnoSnap = await turnoRef.get();\n\n        if (!turnoSnap.exists) {\n            return { success: false, error: 'El turno no existe.' };\n        }\n\n        const turnoData = turnoSnap.data();\n\n        if (turnoData.clienteId !== userId) {\n            return { success: false, error: 'No tienes permiso para cancelar este turno.' };\n        }\n\n        if ([ 'cancelado', 'completado'].includes(turnoData.estado)) {\n            return { success: false, error: 'Este turno ya no se puede cancelar.' };\n        }\n\n        const hoy = new Date();\n        hoy.setHours(0, 0, 0, 0);\n        const fechaTurno = new Date(turnoData.fecha + 'T12:00:00'); \n\n        if (fechaTurno < hoy) {\n            return { success: false, error: 'No se puede cancelar un turno que ya ha pasado.' };\n        }\n\n        await turnoRef.update({\n            estado: 'cancelado',\n            canceladoAt: new Date().toISOString(),\n            canceladoPor: 'usuario'\n        });\n\n        revalidatePath('/mis-turnos');\n        revalidatePath('/admin/turnos');\n\n        return { success: true };\n\n    } catch (error) {\n        console.error('Error al cancelar el turno:', error);\n        return { success: false, error: 'Ocurrió un error inesperado al intentar cancelar el turno.' };\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 259, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/.next-internal/server/app/turnos/consulta/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {solicitarTurnoConsulta as '40f3851fa82a1cdd976d911fc02bab21b6987feaa3'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 292, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/FormularioTurnoConsulta.jsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/components/FormularioTurnoConsulta.jsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/components/FormularioTurnoConsulta.jsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAkT,GAC/U,gFACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 306, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/FormularioTurnoConsulta.jsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/components/FormularioTurnoConsulta.jsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/components/FormularioTurnoConsulta.jsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA8R,GAC3T,4DACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 320, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 328, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/PrivateRoute.js/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/components/PrivateRoute.js <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/components/PrivateRoute.js <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAsS,GACnU,oEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 342, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/PrivateRoute.js/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/components/PrivateRoute.js from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/components/PrivateRoute.js\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAkR,GAC/S,gDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 356, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 364, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/Footer.jsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/components/Footer.jsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/components/Footer.jsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAiS,GAC9T,+DACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 378, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/Footer.jsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/components/Footer.jsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/components/Footer.jsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA6Q,GAC1S,2CACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 392, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 400, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/turnos/consulta/page.js"],"sourcesContent":["\nimport { cookies } from 'next/headers';\nimport { redirect } from 'next/navigation';\nimport admin from '@/lib/firebaseAdmin';\nimport { getUserIdFromSession } from '@/lib/firebaseAdmin';\n\nimport FormularioTurnoConsulta from '@/app/components/FormularioTurnoConsulta.jsx';\nimport PrivateRoute from '@/app/components/PrivateRoute';\nimport Footer from '@/app/components/Footer';\n\n// Función para sanear los datos: convierte Timestamps a strings.\nconst sanitizeData = (docData) => {\n  if (!docData) return null;\n  const data = { ...docData };\n  for (const key in data) {\n    if (data[key] && typeof data[key].toDate === 'function') {\n      data[key] = data[key].toDate().toISOString();\n    }\n  }\n  return data;\n};\n\nasync function getUserMascotas(userId) {\n    if (!userId) return [];\n\n    const firestore = admin.firestore();\n    try {\n        const mascotasSnap = await firestore.collection('users').doc(userId).collection('mascotas').orderBy('nombre', 'asc').get();\n        if (mascotasSnap.empty) {\n            return [];\n        }\n        return mascotasSnap.docs.map(doc => ({ id: doc.id, ...sanitizeData(doc.data()) }));\n    } catch (error) {\n        console.error(\"Error al obtener las mascotas en el servidor:\", error);\n        return [];\n    }\n}\n\nexport default async function ConsultaPage() {\n    const sessionCookie = cookies().get('__session')?.value || '';\n    const userId = await getUserIdFromSession(sessionCookie);\n\n    if (!userId) {\n        redirect('/login');\n    }\n\n    const mascotas = await getUserMascotas(userId);\n\n    if (mascotas.length === 0) {\n        return (\n            <PrivateRoute>\n                <main className=\"container mx-auto px-4 py-12 bg-gray-50 text-center\">\n                    <div className=\"max-w-xl mx-auto\">\n                        <h1 className=\"text-3xl font-bold text-gray-800 mb-4\">Primero registra a tu mascota</h1>\n                        <p className=\"text-gray-600 mb-6\">\n                            Para poder solicitar un turno, primero necesitas tener al menos una mascota registrada en tu perfil.\n                        </p>\n                        <a href=\"/mascotas/nueva\" className=\"inline-block bg-violet-600 text-white font-semibold py-3 px-6 rounded-full hover:bg-violet-700 transition-colors\">\n                            Registrar una Mascota\n                        </a>\n                    </div>\n                </main>\n                <Footer />\n            </PrivateRoute>\n        );\n    }\n\n    return (\n        <PrivateRoute>\n            <main className=\"container mx-auto px-4 py-12 bg-gray-50\">\n                <div className=\"max-w-4xl mx-auto\">\n                    <h1 className=\"text-4xl font-extrabold text-center mb-2 text-gray-800\">Portal de Turnos</h1>\n                    <p className=\"text-lg text-center text-gray-600 mb-10\">Solicita un turno para una consulta veterinaria.</p>\n                    \n                    <FormularioTurnoConsulta mascotas={mascotas} />\n                </div>\n            </main>\n            <Footer />\n        </PrivateRoute>\n    );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;;;;;;;;;AAEA,iEAAiE;AACjE,MAAM,eAAe,CAAC;IACpB,IAAI,CAAC,SAAS,OAAO;IACrB,MAAM,OAAO;QAAE,GAAG,OAAO;IAAC;IAC1B,IAAK,MAAM,OAAO,KAAM;QACtB,IAAI,IAAI,CAAC,IAAI,IAAI,OAAO,IAAI,CAAC,IAAI,CAAC,MAAM,KAAK,YAAY;YACvD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,WAAW;QAC5C;IACF;IACA,OAAO;AACT;AAEA,eAAe,gBAAgB,MAAM;IACjC,IAAI,CAAC,QAAQ,OAAO,EAAE;IAEtB,MAAM,YAAY,sIAAK,CAAC,SAAS;IACjC,IAAI;QACA,MAAM,eAAe,MAAM,UAAU,UAAU,CAAC,SAAS,GAAG,CAAC,QAAQ,UAAU,CAAC,YAAY,OAAO,CAAC,UAAU,OAAO,GAAG;QACxH,IAAI,aAAa,KAAK,EAAE;YACpB,OAAO,EAAE;QACb;QACA,OAAO,aAAa,IAAI,CAAC,GAAG,CAAC,CAAA,MAAO,CAAC;gBAAE,IAAI,IAAI,EAAE;gBAAE,GAAG,aAAa,IAAI,IAAI,GAAG;YAAC,CAAC;IACpF,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,iDAAiD;QAC/D,OAAO,EAAE;IACb;AACJ;AAEe,eAAe;IAC1B,MAAM,gBAAgB,IAAA,0IAAO,IAAG,GAAG,CAAC,cAAc,SAAS;IAC3D,MAAM,SAAS,MAAM,IAAA,mJAAoB,EAAC;IAE1C,IAAI,CAAC,QAAQ;QACT,IAAA,iMAAQ,EAAC;IACb;IAEA,MAAM,WAAW,MAAM,gBAAgB;IAEvC,IAAI,SAAS,MAAM,KAAK,GAAG;QACvB,qBACI,8OAAC,mJAAY;;8BACT,8OAAC;oBAAK,WAAU;8BACZ,cAAA,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;gCAAG,WAAU;0CAAwC;;;;;;0CACtD,8OAAC;gCAAE,WAAU;0CAAqB;;;;;;0CAGlC,8OAAC;gCAAE,MAAK;gCAAkB,WAAU;0CAAmH;;;;;;;;;;;;;;;;;8BAK/J,8OAAC,8IAAM;;;;;;;;;;;IAGnB;IAEA,qBACI,8OAAC,mJAAY;;0BACT,8OAAC;gBAAK,WAAU;0BACZ,cAAA,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;4BAAG,WAAU;sCAAyD;;;;;;sCACvE,8OAAC;4BAAE,WAAU;sCAA0C;;;;;;sCAEvD,8OAAC,+JAAuB;4BAAC,UAAU;;;;;;;;;;;;;;;;;0BAG3C,8OAAC,8IAAM;;;;;;;;;;;AAGnB","debugId":null}}]
}