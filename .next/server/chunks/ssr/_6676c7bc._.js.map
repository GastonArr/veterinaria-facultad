{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/actions.js"],"sourcesContent":["\n'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport admin from '@/lib/firebaseAdmin';\n\nconst aplicationRoles = {\n  '00000001': 'admin',      // Magali - DNI sin puntos\n  '00000002': 'peluquera',\n  '00000003': 'transporte',\n};\n\nexport async function completarPerfil(userId, userData) {\n  const firestore = admin.firestore();\n  const auth = admin.auth();\n\n  const { dni, phone, direccion, localidad, provincia } = userData;\n  \n  if (!userId || !dni || !phone || !direccion || !localidad || !provincia) {\n    return { success: false, error: 'Faltan datos por completar.' };\n  }\n\n  try {\n    const userRole = aplicationRoles[dni] || 'cliente';\n\n    await auth.setCustomUserClaims(userId, { role: userRole });\n\n    await firestore.collection('users').doc(userId).set({\n      dni,\n      phone,\n      direccion,\n      localidad,\n      provincia,\n      role: userRole,\n      profileCompleted: true,\n    }, { merge: true });\n\n    revalidatePath('/');\n    \n    return { success: true, role: userRole };\n\n  } catch (error) {\n    console.error('Error al completar el perfil:', error);\n    return { success: false, error: 'Ocurrió un error en el servidor al procesar tu perfil.' };\n  }\n}\n\n/**\n * Server Action para agregar una nueva mascota a un usuario.\n */\nexport async function agregarMascota(userId, mascotaData) {\n    if (!userId) {\n        return { success: false, error: 'Usuario no autenticado.' };\n    }\n\n    // Se añade el campo 'tamaño' a la desestructuración\n    const { nombre, especie, raza, fechaNacimiento, tamaño, enAdopcion } = mascotaData;\n\n    if (!nombre || !especie || !raza || !fechaNacimiento || !tamaño) {\n        return { success: false, error: 'Todos los campos, incluyendo el tamaño, son obligatorios.' };\n    }\n\n    const firestore = admin.firestore();\n\n    try {\n        const mascotaRef = await firestore.collection('users').doc(userId).collection('mascotas').add({\n            nombre,\n            especie,\n            raza,\n            fechaNacimiento,\n            tamaño, // Se añade el campo 'tamaño' al objeto que se guarda\n            enAdopcion: enAdopcion || false, \n            createdAt: new Date(),\n        });\n\n        revalidatePath('/mascotas');\n\n        return { success: true, mascotaId: mascotaRef.id };\n\n    } catch (error) {\n        console.error('Error al agregar la mascota:', error);\n        return { success: false, error: 'No se pudo registrar la mascota en la base de datos.' };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IAkDsB,iBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA","debugId":null}},
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/FormularioNuevaMascota.jsx"],"sourcesContent":["\n'use client';\n\nimport { useState } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { agregarMascota } from '@/app/actions';\nimport { Timestamp } from 'firebase/firestore'; // Importamos Timestamp\n\nexport default function FormularioNuevaMascota() {\n    const { user } = useAuth();\n    const [error, setError] = useState('');\n    const [success, setSuccess] = useState('');\n    const [loading, setLoading] = useState(false);\n\n    const handleSubmit = async (event) => {\n        event.preventDefault();\n        setError('');\n        setSuccess('');\n        setLoading(true);\n\n        if (!user) {\n            setError('Debes iniciar sesión para registrar una mascota.');\n            setLoading(false);\n            return;\n        }\n\n        const formData = new FormData(event.currentTarget);\n        const mascotaData = {\n            nombre: formData.get('nombre'),\n            especie: formData.get('especie'),\n            raza: formData.get('raza'),\n            fechaNacimiento: formData.get('fechaNacimiento'),\n            sexo: formData.get('sexo'), // Corregido para que tome el valor de sexo\n            tamaño: formData.get('tamaño'),\n            enAdopcion: formData.get('enAdopcion') === 'on',\n            createdAt: Timestamp.now() // ¡SOLUCIÓN! Añadimos el timestamp actual.\n        };\n\n        // Validación simple para que no envíen datos vacíos\n        if (!mascotaData.nombre || !mascotaData.especie || !mascotaData.raza || !mascotaData.fechaNacimiento || !mascotaData.sexo) {\n            setError(\"Por favor, completa todos los campos obligatorios.\");\n            setLoading(false);\n            return;\n        }\n\n        try {\n            const result = await agregarMascota(user.uid, mascotaData);\n\n            if (result.success) {\n                setSuccess('¡Mascota registrada con éxito! En breve serás redirigido...');\n                event.target.reset();\n                setTimeout(() => {\n                    window.location.href = '/mascotas';\n                }, 2000);\n            } else {\n                setError(result.error || 'Ocurrió un error inesperado.');\n            }\n        } catch (err) {\n            setError(err.message);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    return (\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n             <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                    <label htmlFor=\"nombre\" className=\"block text-sm font-medium text-gray-700\">Nombre</label>\n                    <input type=\"text\" name=\"nombre\" id=\"nombre\" required className=\"mt-1 block w-full input\" placeholder=\"Ej: Rocky\" disabled={loading} />\n                </div>\n                <div>\n                    <label htmlFor=\"fechaNacimiento\" className=\"block text-sm font-medium text-gray-700\">Fecha de Nacimiento</label>\n                    <input type=\"date\" name=\"fechaNacimiento\" id=\"fechaNacimiento\" required className=\"mt-1 block w-full input\" disabled={loading} />\n                </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                 <div>\n                    <label htmlFor=\"especie\" className=\"block text-sm font-medium text-gray-700\">Especie</label>\n                    <input type=\"text\" name=\"especie\" id=\"especie\" required className=\"mt-1 block w-full input\" placeholder=\"Ej: Perro\" disabled={loading} />\n                </div>\n                <div>\n                    <label htmlFor=\"raza\" className=\"block text-sm font-medium text-gray-700\">Raza</label>\n                    <input type=\"text\" name=\"raza\" id=\"raza\" required className=\"mt-1 block w-full input\" placeholder=\"Ej: Labrador\" disabled={loading} />\n                </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n               <div>\n                    <label htmlFor=\"sexo\" className=\"block text-sm font-medium text-gray-700\">Sexo</label>\n                    <select name=\"sexo\" id=\"sexo\" required className=\"mt-1 block w-full input\" disabled={loading}>\n                        <option value=\"\">Selecciona...</option>\n                        <option value=\"macho\">Macho</option>\n                        <option value=\"hembra\">Hembra</option>\n                    </select>\n                </div>\n                <div>\n                    <label htmlFor=\"tamaño\" className=\"block text-sm font-medium text-gray-700\">Tamaño</label>\n                    <select name=\"tamaño\" id=\"tamaño\" required className=\"mt-1 block w-full input\" disabled={loading}>\n                        <option value=\"pequeño\">Pequeño</option>\n                        <option value=\"mediano\">Mediano</option>\n                        <option value=\"grande\">Grande</option>\n                    </select>\n                </div>\n            </div>\n\n            <div className=\"flex items-center pt-4\">\n                <input id=\"enAdopcion\" name=\"enAdopcion\" type=\"checkbox\" className=\"h-4 w-4 text-violet-600 focus:ring-violet-500 border-gray-300 rounded\" disabled={loading} />\n                <label htmlFor=\"enAdopcion\" className=\"ml-3 block text-sm text-gray-900\">Marcar para poner en adopción</label>\n            </div>\n            \n            {error && <p className=\"text-sm text-red-600 bg-red-100 p-3 rounded-md\">{error}</p>}\n            {success && <p className=\"text-sm text-green-600 bg-green-100 p-3 rounded-md\">{success}</p>}\n\n            <div className=\"pt-6\">\n                <button \n                    type=\"submit\" \n                    disabled={loading}\n                    className=\"w-full flex justify-center py-3 px-4 border border-transparent rounded-full shadow-sm text-lg font-medium text-white bg-violet-600 hover:bg-violet-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-violet-500 transition-colors duration-300 disabled:bg-violet-400 disabled:cursor-not-allowed\"\n                >\n                    {loading ? 'Guardando...' : 'Registrar Mascota'}\n                </button>\n            </div>\n        </form>\n    );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 412, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-client-wrapper.ts"],"sourcesContent":["// This file must be bundled in the app's client layer, it shouldn't be directly\n// imported by the server.\n\nexport { callServer } from 'next/dist/client/app-call-server'\nexport { findSourceMapURL } from 'next/dist/client/app-find-source-map-url'\n\n// A noop wrapper to let the Flight client create the server reference.\n// See also: https://github.com/facebook/react/pull/26632\n// eslint-disable-next-line import/no-extraneous-dependencies\nexport { createServerReference } from 'react-server-dom-webpack/client'\n"],"names":["callServer","createServerReference","findSourceMapURL"],"mappings":"AAAA,gFAAgF;AAChF,0BAA0B;;;;;;;;;;;;;;;;IAEjBA,UAAU,EAAA;eAAVA,eAAAA,UAAU;;IAMVC,qBAAqB,EAAA;eAArBA,QAAAA,qBAAqB;;IALrBC,gBAAgB,EAAA;eAAhBA,qBAAAA,gBAAgB;;;+BADE;qCACM;wBAKK","ignoreList":[0],"debugId":null}}]
}