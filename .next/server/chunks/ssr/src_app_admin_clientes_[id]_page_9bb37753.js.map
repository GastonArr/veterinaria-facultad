{"version":3,"sources":["turbopack:///[project]/src/app/admin/clientes/[id]/page.js","turbopack:///[project]/src/app/components/StarRating.jsx"],"sourcesContent":["\n'use client';\nimport { useState, useEffect } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { db } from '@/lib/firebase'; // <-- CORREGIDO\nimport { doc, getDoc, collection, getDocs, query, where, updateDoc } from 'firebase/firestore';\nimport { useParams, useRouter } from 'next/navigation';\nimport StarRating from '@/app/components/StarRating';\n\nconst ClienteDetallePage = () => {\n  const { userRole } = useAuth();\n  const router = useRouter();\n  const params = useParams();\n  const { id } = params; // El ID del cliente desde la URL\n\n  const [cliente, setCliente] = useState(null);\n  const [mascotas, setMascotas] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (userRole !== 'admin' || !id) {\n        if(userRole && userRole !== 'admin') router.push('/');\n        return;\n    }\n\n    const fetchClienteYMascotas = async () => {\n      setLoading(true);\n      try {\n        // 1. Obtener datos del cliente\n        const clienteRef = doc(db, 'users', id); // <-- CORREGIDO\n        const clienteSnap = await getDoc(clienteRef);\n\n        if (clienteSnap.exists()) {\n          setCliente({ id: clienteSnap.id, ...clienteSnap.data() });\n        } else {\n          console.error(\"No se encontró el cliente.\");\n          router.push('/admin/clientes');\n          return;\n        }\n\n        // 2. Obtener mascotas del cliente\n        const mascotasRef = collection(db, 'pets'); // <-- CORREGIDO\n        const q = query(mascotasRef, where(\"ownerId\", \"==\", id));\n        const mascotasSnap = await getDocs(q);\n        const mascotasData = mascotasSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n        setMascotas(mascotasData);\n\n      } catch (error) {\n        console.error(\"Error al obtener los datos:\", error);\n      }\n      setLoading(false);\n    };\n\n    fetchClienteYMascotas();\n  }, [id, userRole, router]);\n\n  const handleRatingChange = async (clientId, newRating) => {\n    if (userRole !== 'admin') return;\n    try {\n        const clientRef = doc(db, 'users', clientId); // <-- CORREGIDO\n        await updateDoc(clientRef, { rating: newRating });\n        setCliente(prev => ({...prev, rating: newRating}));\n    } catch (error) {\n        console.error(\"Error al actualizar la calificación: \", error);\n    }\n  };\n\n  if (loading || !userRole) {\n    return <p className=\"text-center mt-8\">Cargando datos del cliente...</p>;\n  }\n\n  if (userRole !== 'admin') {\n    return <p className=\"text-red-500 text-center mt-8\">No tienes permiso para ver esta página.</p>;\n  }\n  \n  if (!cliente) {\n    return (\n        <div className=\"text-center mt-8\">\n            <p>No se pudo encontrar la información del cliente.</p>\n            <button onClick={() => router.push('/admin/clientes')} className=\"mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\">\n                Volver a la lista\n            </button>\n        </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n        <button onClick={() => router.back()} className=\"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded mb-6 inline-flex items-center\">\n            <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M15 19l-7-7 7-7\"></path></svg>\n            Volver\n        </button>\n\n        {/* Tarjeta de Información del Cliente */}\n        <div className=\"bg-white shadow-lg rounded-lg p-6 md:p-8 mb-8\">\n            <div className=\"flex flex-col sm:flex-row sm:items-center mb-4\">\n                <h1 className=\"text-2xl md:text-3xl font-bold text-gray-800 mr-4\">{cliente.displayName}</h1>\n                <div className=\"mt-2 sm:mt-0\">\n                    <StarRating clientId={cliente.id} initialRating={cliente.rating || 0} onRatingChange={handleRatingChange} />\n                </div>\n            </div>\n            <div className=\"text-gray-600 space-y-2\">\n                <p><strong>Email:</strong> {cliente.email}</p>\n                <p><strong>Teléfono:</strong> {cliente.phone || 'No especificado'}</p>\n            </div>\n        </div>\n\n        {/* Sección de Mascotas */}\n        <h2 className=\"text-2xl font-semibold mb-4 text-gray-700\">Mascotas Registradas</h2>\n        <div className=\"bg-white shadow-md rounded my-6 overflow-x-auto\">\n            {mascotas.length > 0 ? (\n                <table className=\"min-w-full leading-normal\">\n                    <thead>\n                        <tr>\n                            <th className=\"px-5 py-3 border-b-2 border-gray-200 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider\">Nombre</th>\n                            <th className=\"px-5 py-3 border-b-2 border-gray-200 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider\">Especie</th>\n                            <th className=\"px-5 py-3 border-b-2 border-gray-200 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider\">Raza</th>\n                            <th className=\"px-5 py-3 border-b-2 border-gray-200 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider\">Edad</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {mascotas.map(mascota => (\n                            <tr key={mascota.id}>\n                                <td className=\"px-5 py-5 border-b border-gray-200 bg-white text-sm\">{mascota.name || 'N/A'}</td>\n                                <td className=\"px-5 py-5 border-b border-gray-200 bg-white text-sm\">{mascota.species || 'N/A'}</td>\n                                <td className=\"px-5 py-5 border-b border-gray-200 bg-white text-sm\">{mascota.breed || 'N/A'}</td>\n                                <td className=\"px-5 py-5 border-b border-gray-200 bg-white text-sm\">{mascota.age ? `${mascota.age} años` : 'N/A'}</td>\n                            </tr>\n                        ))}\n                    </tbody>\n                </table>\n            ) : (\n                <div className=\"text-center p-5\">\n                    <p className=\"text-gray-500\">Este cliente aún no ha registrado ninguna mascota.</p>\n                </div>\n            )}\n        </div>\n    </div>\n  );\n};\n\nexport default ClienteDetallePage;\n","\n'use client';\nimport { useState } from 'react';\n\nconst StarRating = ({ clientId, initialRating, onRatingChange }) => {\n  const [rating, setRating] = useState(initialRating);\n  const [hoverRating, setHoverRating] = useState(0);\n\n  const handleMouseOver = (starIndex) => {\n    setHoverRating(starIndex);\n  };\n\n  const handleMouseLeave = () => {\n    setHoverRating(0);\n  };\n\n  const handleClick = (starIndex) => {\n    const newRating = starIndex;\n    setRating(newRating);\n    onRatingChange(clientId, newRating);\n  };\n\n  return (\n    <div className=\"flex items-center\">\n      {[1, 2, 3, 4, 5].map((starIndex) => (\n        <svg\n          key={starIndex}\n          className={`w-6 h-6 cursor-pointer fill-current ${ \n            (hoverRating || rating) >= starIndex ? 'text-yellow-400' : 'text-gray-300'\n          }`}\n          onMouseOver={() => handleMouseOver(starIndex)}\n          onMouseLeave={handleMouseLeave}\n          onClick={() => handleClick(starIndex)}\n          xmlns=\"http://www.w3.org/2000/svg\"\n          viewBox=\"0 0 24 24\"\n        >\n          <path d=\"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z\" />\n        </svg>\n      ))}\n    </div>\n  );\n};\n\nexport default StarRating;\n"],"names":[],"mappings":"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"}