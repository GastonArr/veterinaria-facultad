{"version":3,"sources":["turbopack:///[project]/src/app/completar-perfil/page.js"],"sourcesContent":["// Historia de Usuario 6: Completar Perfil de Usuario\n\n'use client';\n\nimport { useState, useTransition, useEffect } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useRouter } from 'next/navigation';\nimport { Toaster, toast } from 'react-hot-toast';\nimport { completarPerfil } from '@/app/actions';\nimport { doc, getDoc } from 'firebase/firestore';\nimport { db } from '@/lib/firebase';\n\n\nconst FormInput = ({ id, name, type, placeholder, value, onChange, required = false, pattern, maxLength, label, children, disabled = false }) => (\n    <div className=\"mb-4\">\n        <label className=\"block text-gray-700 text-sm font-bold mb-2\" htmlFor={id}>{label}</label>\n        <div className=\"relative\">\n            <input\n                className={`shadow-sm appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10 ${disabled ? 'bg-gray-100 cursor-not-allowed' : ''}`}\n                id={id} name={name} type={type} placeholder={placeholder} value={value}\n                onChange={onChange} required={required} pattern={pattern} maxLength={maxLength} disabled={disabled}\n            />\n            {children}\n        </div>\n    </div>\n);\n\nexport default function CompletarPerfilPage() {\n  const { user, loading: authLoading } = useAuth();\n  const router = useRouter();\n  const [isPending, startTransition] = useTransition();\n  const [profileLoading, setProfileLoading] = useState(true);\n\n  const [formData, setFormData] = useState({\n    nombre: '',\n    apellido: '',\n    dni: '',\n    telefonoPrincipal: '',\n    telefonoSecundario: '',\n    direccion: '',\n    barrio: '',\n    nombreContactoEmergencia: '',\n    telefonoContactoEmergencia: '',\n  });\n\n  useEffect(() => {\n    if (authLoading) return; \n\n    if (!user) {\n      router.replace('/login');\n      return;\n    }\n\n    const checkProfile = async () => {\n        const userDocRef = doc(db, 'users', user.uid);\n        const userDocSnap = await getDoc(userDocRef);\n\n        if (userDocSnap.exists() && userDocSnap.data().profileCompleted) {\n            toast.success('Tu perfil ya está completo.', { duration: 2000 });\n            router.replace('/');\n        } else {\n            const existingData = userDocSnap.data() || {};\n            const [firstName, ...lastNameParts] = user.displayName?.split(' ') || ['', ''];\n            setFormData(prev => ({\n                ...prev,\n                nombre: existingData.nombre || firstName,\n                apellido: existingData.apellido || lastNameParts.join(' '),\n                ...existingData\n            }));\n            setProfileLoading(false);\n        }\n    };\n\n    checkProfile();\n\n  }, [user, authLoading, router]);\n\n  const handleChange = (e) => {\n    const { name, value } = e.target;\n    if ((name === 'dni' || name.includes('telefono')) && value && !/^[0-9]+$/.test(value)) {\n      return; // Solo números para DNI y teléfonos\n    }\n    setFormData((prev) => ({ ...prev, [name]: value }));\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (!user) {\n      toast.error('Tu sesión ha expirado. Por favor, inicia sesión de nuevo.');\n      return router.push('/login');\n    }\n\n    startTransition(async () => {\n      const result = await completarPerfil(user.uid, formData);\n\n      if (result.success) {\n        toast.success('¡Perfil completado con éxito! Redirigiendo...');\n        setTimeout(() => {\n            router.push(result.role === 'admin' ? '/admin' : '/');\n        }, 1500);\n      } else {\n        toast.error(result.error || 'Hubo un error al guardar tu perfil.');\n      }\n    });\n  };\n\n  if (authLoading || profileLoading) {\n    return (\n        <div className=\"flex justify-center items-center h-screen bg-gray-50\">\n            <div className=\"loader\"></div> {/* Un spinner de carga más visual */}\n            <style jsx>{`\n                .loader {\n                    border: 4px solid #f3f3f3; /* Light grey */\n                    border-top: 4px solid #3498db; /* Blue */\n                    border-radius: 50%;\n                    width: 40px;\n                    height: 40px;\n                    animation: spin 1s linear infinite;\n                }\n                @keyframes spin {\n                    0% { transform: rotate(0deg); }\n                    100% { transform: rotate(360deg); }\n                }\n            `}</style>\n        </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8\">\n        <Toaster position=\"bottom-center\" />\n        <div className=\"sm:mx-auto sm:w-full sm:max-w-2xl\">\n            <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900\">Completa tu Perfil</h2>\n            <p className=\"mt-2 text-center text-sm text-gray-600\">\n                ¡Casi listo! Solo necesitamos un par de datos más para continuar.\n            </p>\n        </div>\n\n        <div className=\"mt-8 sm:mx-auto sm:w-full sm:max-w-2xl\">\n            <div className=\"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10\">\n                <form onSubmit={handleSubmit} className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <FormInput id=\"nombre\" name=\"nombre\" type=\"text\" label=\"Nombre\" placeholder=\"Juan\" value={formData.nombre} onChange={handleChange} required />\n                    <FormInput id=\"apellido\" name=\"apellido\" type=\"text\" label=\"Apellido\" placeholder=\"Pérez\" value={formData.apellido} onChange={handleChange} required />\n                </div>\n                <FormInput id=\"dni\" name=\"dni\" type=\"tel\" label=\"DNI\" placeholder=\"Sin puntos ni espacios\" value={formData.dni} onChange={handleChange} required maxLength=\"8\" />\n                <FormInput id=\"direccion\" name=\"direccion\" type=\"text\" label=\"Dirección\" placeholder=\"Av. Siempreviva 742\" value={formData.direccion} onChange={handleChange} required />\n                <FormInput id=\"barrio\" name=\"barrio\" type=\"text\" label=\"Barrio\" placeholder=\"Springfield\" value={formData.barrio} onChange={handleChange} required />\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <FormInput id=\"telefonoPrincipal\" name=\"telefonoPrincipal\" type=\"tel\" label=\"Teléfono Principal\" placeholder=\"1122334455\" value={formData.telefonoPrincipal} onChange={handleChange} required />\n                    <FormInput id=\"telefonoSecundario\" name=\"telefonoSecundario\" type=\"tel\" label=\"Teléfono Secundario\" placeholder=\"(Opcional)\" value={formData.telefonoSecundario} onChange={handleChange} />\n                </div>\n                \n                <hr className=\"my-6\" />\n                <h3 className=\"text-lg font-semibold text-gray-700 mb-4\">Contacto de Emergencia</h3>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <FormInput id=\"nombreContactoEmergencia\" name=\"nombreContactoEmergencia\" type=\"text\" label=\"Nombre\" placeholder=\"Jane Doe\" value={formData.nombreContactoEmergencia} onChange={handleChange} required />\n                    <FormInput id=\"telefonoContactoEmergencia\" name=\"telefonoContactoEmergencia\" type=\"tel\" label=\"Teléfono\" placeholder=\"1188776655\" value={formData.telefonoContactoEmergencia} onChange={handleChange} required />\n                </div>\n\n                    <div>\n                        <button type=\"submit\" disabled={isPending} className=\"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed\">\n                            {isPending ? 'Guardando...' : 'Guardar y Finalizar'}\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}