{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/actions/mascotasActions.js"],"sourcesContent":["\n'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport { firestore } from '@/lib/firebaseAdmin';\n\nexport async function registrarMascota(user, mascotaData) {\n  if (!user || !user.uid) {\n    return { success: false, error: 'Usuario no autenticado.' };\n  }\n\n  const { nombre, especie, fechaNacimiento, sexo, enAdopcion } = mascotaData;\n  if (!nombre || !especie || !fechaNacimiento || !sexo) {\n    return { success: false, error: 'Faltan datos obligatorios de la mascota.' };\n  }\n\n  try {\n    const mascotasCollection = firestore.collection('users').doc(user.uid).collection('mascotas');\n    \n    const nuevaMascota = {\n      ...mascotaData,\n      enAdopcion: enAdopcion || false,\n      fechaNacimiento: new Date(fechaNacimiento),\n      fechaRegistro: new Date(),\n      ownerId: user.uid, // Guardamos referencia al dueño\n    };\n\n    // Guardamos la mascota en la subcolección del usuario\n    const mascotaRef = await mascotasCollection.add(nuevaMascota);\n\n    // --- Estrategia de Desnormalización ---\n    if (nuevaMascota.enAdopcion) {\n      // Si está en adopción, creamos una copia en la colección principal `adopciones`\n      const adopcionDoc = {\n        ...nuevaMascota,\n        mascotaId: mascotaRef.id, // Guardamos el ID original para referencia\n        ownerName: user.displayName || 'Anónimo',\n        ownerEmail: user.email,\n      };\n      // Usamos el mismo ID para facilitar la sincronización y eliminación\n      await firestore.collection('adopciones').doc(mascotaRef.id).set(adopcionDoc);\n    }\n\n    // Revalidamos las páginas para que los cambios se reflejen\n    revalidatePath('/mascotas');\n    if (enAdopcion) {\n        revalidatePath('/adopciones');\n    }\n\n    return { success: true };\n\n  } catch (error) {\n    console.error('Error al registrar la mascota:', error);\n    return { success: false, error: 'Ocurrió un error en el servidor al registrar la mascota.' };\n  }\n}\n"],"names":[],"mappings":";;;;;;;IAMsB,mBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA","debugId":null}},
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/mascotas/nueva/page.js"],"sourcesContent":["\n'use client';\n\nimport { useState, useTransition } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Toaster, toast } from 'react-hot-toast';\nimport { registrarMascota } from '@/app/actions/mascotasActions';\nimport { ShieldCheckIcon, ArrowLeftIcon } from '@heroicons/react/24/outline'; // Iconos de contorno\nimport { PawPrintIcon } from '@heroicons/react/24/solid'; // Iconos sólidos\n\nexport default function NuevaMascotaPage() {\n  const { user, loading: authLoading } = useAuth();\n  const router = useRouter();\n  const [isPending, startTransition] = useTransition();\n\n  const [formData, setFormData] = useState({\n    nombre: '',\n    especie: '',\n    raza: '',\n    fechaNacimiento: '',\n    sexo: '',\n    enAdopcion: false, // Nuevo campo para adopción\n  });\n\n  const handleChange = (e) => {\n    const { name, value, type, checked } = e.target;\n    setFormData(prev => ({ ...prev, [name]: type === 'checkbox' ? checked : value }));\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (!user) {\n        return toast.error(\"Debes iniciar sesión para registrar una mascota.\");\n    }\n\n    startTransition(async () => {\n        const result = await registrarMascota(user, formData);\n        if (result.success) {\n            toast.success('¡Mascota registrada con éxito!');\n            router.push('/mascotas');\n        } else {\n            toast.error(result.error || \"Hubo un problema al registrar la mascota.\");\n        }\n    });\n  };\n\n  if (authLoading) {\n      return (\n          <div className=\"flex justify-center items-center h-screen bg-violet-100\">\n              <div className=\"text-center\">\n                  <PawPrintIcon className=\"animate-spin h-12 w-12 text-violet-600 mx-auto\" />\n                  <p className=\"text-violet-800 font-semibold mt-2\">Cargando tu perfil...</p>\n              </div>\n          </div>\n      );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-violet-200 flex flex-col justify-center py-12 sm:px-6 lg:px-8 font-sans\">\n      <Toaster position=\"top-center\" toastOptions={{ duration: 4000 }} />\n      <div className=\"sm:mx-auto sm:w-full sm:max-w-xl\">\n          <button onClick={() => router.back()} className=\"flex items-center gap-2 text-violet-800 hover:text-violet-900 font-semibold mb-4\">\n              <ArrowLeftIcon className=\"h-5 w-5\" />\n              Volver\n          </button>\n          <div className=\"bg-white/60 backdrop-blur-sm p-4 rounded-2xl shadow-lg\">\n              <div className=\"sm:mx-auto sm:w-full sm:max-w-md\">\n                <PawPrintIcon className=\"mx-auto h-12 w-auto text-violet-800\" />\n                <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900\">Registrar Mascota</h2>\n                <p className=\"mt-2 text-center text-sm text-gray-600\">\n                  Añade los datos de tu compañero fiel.\n                </p>\n              </div>\n\n              <div className=\"mt-8 sm:mx-auto sm:w-full sm:max-w-md\">\n                <div className=\"bg-transparent py-8 px-4 sm:px-10\">\n                  <form onSubmit={handleSubmit} className=\"space-y-6\">\n                    {/* ... campos del formulario con mejor diseño ... */}\n                    <div>\n                      <label htmlFor=\"nombre\" className=\"block text-sm font-medium text-gray-700\">Nombre</label>\n                      <input id=\"nombre\" name=\"nombre\" type=\"text\" required value={formData.nombre} onChange={handleChange} className=\"input-style\" />\n                    </div>\n                    <div>\n                      <label htmlFor=\"especie\" className=\"block text-sm font-medium text-gray-700\">Especie</label>\n                      <input id=\"especie\" name=\"especie\" type=\"text\" required value={formData.especie} onChange={handleChange} className=\"input-style\" placeholder=\"Ej: Perro, Gato\" />\n                    </div>\n                    <div>\n                      <label htmlFor=\"raza\" className=\"block text-sm font-medium text-gray-700\">Raza</label>\n                      <input id=\"raza\" name=\"raza\" type=\"text\" value={formData.raza} onChange={handleChange} className=\"input-style\" placeholder=\"Ej: Labrador, Siames\" />\n                    </div>\n                    <div>\n                      <label htmlFor=\"fechaNacimiento\" className=\"block text-sm font-medium text-gray-700\">Fecha de Nacimiento</label>\n                      <input id=\"fechaNacimiento\" name=\"fechaNacimiento\" type=\"date\" required value={formData.fechaNacimiento} onChange={handleChange} className=\"input-style\" />\n                    </div>\n                    <div>\n                        <label htmlFor=\"sexo\" className=\"block text-sm font-medium text-gray-700\">Sexo</label>\n                        <select id=\"sexo\" name=\"sexo\" required value={formData.sexo} onChange={handleChange} className=\"input-style\">\n                            <option value=\"\">Selecciona uno...</option>\n                            <option value=\"Macho\">Macho</option>\n                            <option value=\"Hembra\">Hembra</option>\n                        </select>\n                    </div>\n                    \n                    {/* Interruptor para Adopción */}\n                    <div className=\"flex items-center justify-between\">\n                        <span className=\"flex-grow flex flex-col\">\n                            <span className=\"text-sm font-medium text-gray-900\">¿Poner en adopción?</span>\n                            <span className=\"text-xs text-gray-500\">Si marcas esto, tu mascota será visible en la sección pública de adopciones.</span>\n                        </span>\n                        <label htmlFor=\"enAdopcion\" className=\"inline-flex relative items-center cursor-pointer\">\n                            <input type=\"checkbox\" id=\"enAdopcion\" name=\"enAdopcion\" checked={formData.enAdopcion} onChange={handleChange} className=\"sr-only peer\" />\n                            <div className=\"w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-violet-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-violet-600\"></div>\n                        </label>\n                    </div>\n\n                    <div className=\"pt-4\">\n                      <button type=\"submit\" disabled={isPending} className=\"w-full flex justify-center py-3 px-4 border border-transparent rounded-full shadow-lg text-sm font-medium text-white bg-violet-700 hover:bg-violet-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-violet-500 disabled:opacity-60 transition-all duration-300 transform hover:scale-105\">\n                         {isPending ? 'Guardando...' : 'Registrar Mascota'}\n                      </button>\n                    </div>\n                  </form>\n                </div>\n              </div>\n          </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}