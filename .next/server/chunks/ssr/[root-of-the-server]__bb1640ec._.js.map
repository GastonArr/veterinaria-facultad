{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/lib/firebaseAdmin.js"],"sourcesContent":["\nimport admin from 'firebase-admin';\n\n// Esta es la forma correcta y recomendada de inicializar el Admin SDK.\n// Se asegura de que la inicialización solo ocurra una vez.\nif (!admin.apps.length) {\n  try {\n    // Al llamar a initializeApp() sin argumentos, el SDK buscará automáticamente\n    // las credenciales del entorno (Application Default Credentials), que es\n    // la práctica recomendada en entornos de Google Cloud como Firebase Studio.\n    admin.initializeApp();\n  } catch (error) {\n    console.error('Error en la inicialización de Firebase Admin SDK:', error);\n  }\n}\n\n// Exportamos la instancia de admin ya inicializada.\nexport default admin;\n"],"names":[],"mappings":";;;;AACA;;AAEA,uEAAuE;AACvE,2DAA2D;AAC3D,IAAI,CAAC,sIAAK,CAAC,IAAI,CAAC,MAAM,EAAE;IACtB,IAAI;QACF,6EAA6E;QAC7E,yEAAyE;QACzE,4EAA4E;QAC5E,sIAAK,CAAC,aAAa;IACrB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qDAAqD;IACrE;AACF;uCAGe,sIAAK","debugId":null}},
    {"offset": {"line": 33, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/actions/mascotasActions.js"],"sourcesContent":["\n'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport admin from '@/lib/firebaseAdmin';\n\nconst firestore = admin.firestore();\n\nexport async function registrarMascota(user, mascotaData) {\n  if (!user || !user.uid) {\n    return { success: false, error: 'Usuario no autenticado.' };\n  }\n\n  const { nombre, especie, fechaNacimiento, sexo, enAdopcion } = mascotaData;\n  if (!nombre || !especie || !fechaNacimiento || !sexo) {\n    return { success: false, error: 'Faltan datos obligatorios de la mascota.' };\n  }\n\n  try {\n    const mascotasCollection = firestore.collection('users').doc(user.uid).collection('mascotas');\n    \n    const nuevaMascota = {\n      ...mascotaData,\n      enAdopcion: enAdopcion || false,\n      fechaNacimiento: new Date(fechaNacimiento),\n      fechaRegistro: admin.firestore.FieldValue.serverTimestamp(),\n      ownerId: user.uid, // Guardamos referencia al dueño\n    };\n\n    // Guardamos la mascota en la subcolección del usuario\n    const mascotaRef = await mascotasCollection.add(nuevaMascota);\n\n    // --- Estrategia de Desnormalización ---\n    if (nuevaMascota.enAdopcion) {\n      // Si está en adopción, creamos una copia en la colección principal `adopciones`\n      const adopcionDoc = {\n        ...nuevaMascota,\n        mascotaId: mascotaRef.id, // Guardamos el ID original para referencia\n        ownerName: user.displayName || 'Anónimo',\n        ownerEmail: user.email,\n      };\n      // Usamos el mismo ID para facilitar la sincronización y eliminación\n      await firestore.collection('adopciones').doc(mascotaRef.id).set(adopcionDoc);\n    }\n\n    // Revalidamos las páginas para que los cambios se reflejen\n    revalidatePath('/mascotas');\n    if (enAdopcion) {\n        revalidatePath('/adopciones');\n    }\n\n    return { success: true };\n\n  } catch (error) {\n    console.error('Error al registrar la mascota:', error);\n    return { success: false, error: 'Ocurrió un error en el servidor al registrar la mascota.' };\n  }\n}\n"],"names":[],"mappings":";;;;;;AAGA;AACA;;;;;;AAEA,MAAM,YAAY,sIAAK,CAAC,SAAS;AAE1B,eAAe,iBAAiB,IAAI,EAAE,WAAW;IACtD,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,EAAE;QACtB,OAAO;YAAE,SAAS;YAAO,OAAO;QAA0B;IAC5D;IAEA,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,eAAe,EAAE,IAAI,EAAE,UAAU,EAAE,GAAG;IAC/D,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,mBAAmB,CAAC,MAAM;QACpD,OAAO;YAAE,SAAS;YAAO,OAAO;QAA2C;IAC7E;IAEA,IAAI;QACF,MAAM,qBAAqB,UAAU,UAAU,CAAC,SAAS,GAAG,CAAC,KAAK,GAAG,EAAE,UAAU,CAAC;QAElF,MAAM,eAAe;YACnB,GAAG,WAAW;YACd,YAAY,cAAc;YAC1B,iBAAiB,IAAI,KAAK;YAC1B,eAAe,sIAAK,CAAC,SAAS,CAAC,UAAU,CAAC,eAAe;YACzD,SAAS,KAAK,GAAG;QACnB;QAEA,sDAAsD;QACtD,MAAM,aAAa,MAAM,mBAAmB,GAAG,CAAC;QAEhD,yCAAyC;QACzC,IAAI,aAAa,UAAU,EAAE;YAC3B,gFAAgF;YAChF,MAAM,cAAc;gBAClB,GAAG,YAAY;gBACf,WAAW,WAAW,EAAE;gBACxB,WAAW,KAAK,WAAW,IAAI;gBAC/B,YAAY,KAAK,KAAK;YACxB;YACA,oEAAoE;YACpE,MAAM,UAAU,UAAU,CAAC,cAAc,GAAG,CAAC,WAAW,EAAE,EAAE,GAAG,CAAC;QAClE;QAEA,2DAA2D;QAC3D,IAAA,+IAAc,EAAC;QACf,IAAI,YAAY;YACZ,IAAA,+IAAc,EAAC;QACnB;QAEA,OAAO;YAAE,SAAS;QAAK;IAEzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO;YAAE,SAAS;YAAO,OAAO;QAA2D;IAC7F;AACF;;;IAjDsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 109, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/.next-internal/server/app/mascotas/nueva/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {registrarMascota as '60e079242676c3da4e738cd129e80ac36ea3879167'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 142, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/mascotas/nueva/page.js/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/mascotas/nueva/page.js <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/mascotas/nueva/page.js <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAkS,GAC/T,gEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/mascotas/nueva/page.js/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/mascotas/nueva/page.js from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/mascotas/nueva/page.js\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA8Q,GAC3S,4CACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 170, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}