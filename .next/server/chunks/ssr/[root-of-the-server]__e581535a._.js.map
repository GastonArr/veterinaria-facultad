{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/lib/firebaseAdmin.js"],"sourcesContent":["\nimport admin from 'firebase-admin';\n\n// Esta es la forma correcta y recomendada de inicializar el Admin SDK.\n// Se asegura de que la inicialización solo ocurra una vez.\nif (!admin.apps.length) {\n  try {\n    // Al llamar a initializeApp() sin argumentos, el SDK buscará automáticamente\n    // las credenciales del entorno (Application Default Credentials), que es\n    // la práctica recomendada en entornos de Google Cloud como Firebase Studio.\n    admin.initializeApp();\n  } catch (error) {\n    console.error('Error en la inicialización de Firebase Admin SDK:', error);\n  }\n}\n\n/**\n * Verifica la cookie de sesión de Firebase y devuelve el UID del usuario.\n * @param {string} sessionCookie La cadena de la cookie de sesión.\n * @returns {Promise<string|null>} El UID del usuario o null si la cookie no es válida.\n */\nexport async function getUserIdFromSession(sessionCookie) {\n  if (!sessionCookie) {\n    return null;\n  }\n  try {\n    // Verificamos la cookie de sesión. El `true` comprueba si ha sido revocada.\n    const decodedClaims = await admin.auth().verifySessionCookie(sessionCookie, true);\n    return decodedClaims.uid;\n  } catch (error) {\n    // La cookie de sesión es inválida o ha expirado.\n    console.error('Error al verificar la cookie de sesión:', error.code);\n    return null;\n  }\n}\n\n// Exportamos la instancia de admin ya inicializada.\nexport default admin;\n"],"names":[],"mappings":";;;;;;AACA;;AAEA,uEAAuE;AACvE,2DAA2D;AAC3D,IAAI,CAAC,sIAAK,CAAC,IAAI,CAAC,MAAM,EAAE;IACtB,IAAI;QACF,6EAA6E;QAC7E,yEAAyE;QACzE,4EAA4E;QAC5E,sIAAK,CAAC,aAAa;IACrB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qDAAqD;IACrE;AACF;AAOO,eAAe,qBAAqB,aAAa;IACtD,IAAI,CAAC,eAAe;QAClB,OAAO;IACT;IACA,IAAI;QACF,4EAA4E;QAC5E,MAAM,gBAAgB,MAAM,sIAAK,CAAC,IAAI,GAAG,mBAAmB,CAAC,eAAe;QAC5E,OAAO,cAAc,GAAG;IAC1B,EAAE,OAAO,OAAO;QACd,iDAAiD;QACjD,QAAQ,KAAK,CAAC,2CAA2C,MAAM,IAAI;QACnE,OAAO;IACT;AACF;uCAGe,sIAAK","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/PrivateRoute.js/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/components/PrivateRoute.js <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/components/PrivateRoute.js <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAsS,GACnU,oEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/PrivateRoute.js/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/components/PrivateRoute.js from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/components/PrivateRoute.js\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAkR,GAC/S,gDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/turnos/consulta/page.js"],"sourcesContent":["\nimport { cookies } from 'next/headers';\nimport { redirect } from 'next/navigation';\nimport admin from '@/lib/firebaseAdmin';\nimport { getUserIdFromSession } from '@/lib/firebaseAdmin';\n\nimport FormularioTurnoConsulta from '@/app/components/FormularioTurnoConsulta.jsx';\nimport PrivateRoute from '@/app/components/PrivateRoute';\nimport Footer from '@/app/components/Footer';\n\n// Función para sanear los datos: convierte Timestamps a strings.\nconst sanitizeData = (docData) => {\n  if (!docData) return null;\n  const data = { ...docData };\n  for (const key in data) {\n    if (data[key] && typeof data[key].toDate === 'function') {\n      data[key] = data[key].toDate().toISOString();\n    }\n  }\n  return data;\n};\n\nasync function getUserMascotas(userId) {\n    if (!userId) return [];\n\n    const firestore = admin.firestore();\n    try {\n        const mascotasSnap = await firestore.collection('users').doc(userId).collection('mascotas').orderBy('nombre', 'asc').get();\n        if (mascotasSnap.empty) {\n            return [];\n        }\n        return mascotasSnap.docs.map(doc => ({ id: doc.id, ...sanitizeData(doc.data()) }));\n    } catch (error) {\n        console.error(\"Error al obtener las mascotas en el servidor:\", error);\n        return [];\n    }\n}\n\nexport default async function ConsultaPage() {\n    const sessionCookie = cookies().get('__session')?.value || '';\n    const userId = await getUserIdFromSession(sessionCookie);\n\n    if (!userId) {\n        redirect('/login');\n    }\n\n    const mascotas = await getUserMascotas(userId);\n\n    if (mascotas.length === 0) {\n        return (\n            <PrivateRoute>\n                <main className=\"container mx-auto px-4 py-12 bg-gray-50 text-center\">\n                    <div className=\"max-w-xl mx-auto\">\n                        <h1 className=\"text-3xl font-bold text-gray-800 mb-4\">Primero registra a tu mascota</h1>\n                        <p className=\"text-gray-600 mb-6\">\n                            Para poder solicitar un turno, primero necesitas tener al menos una mascota registrada en tu perfil.\n                        </p>\n                        <a href=\"/mascotas/nueva\" className=\"inline-block bg-violet-600 text-white font-semibold py-3 px-6 rounded-full hover:bg-violet-700 transition-colors\">\n                            Registrar una Mascota\n                        </a>\n                    </div>\n                </main>\n                <Footer />\n            </PrivateRoute>\n        );\n    }\n\n    return (\n        <PrivateRoute>\n            <main className=\"container mx-auto px-4 py-12 bg-gray-50\">\n                <div className=\"max-w-4xl mx-auto\">\n                    <h1 className=\"text-4xl font-extrabold text-center mb-2 text-gray-800\">Portal de Turnos</h1>\n                    <p className=\"text-lg text-center text-gray-600 mb-10\">Solicita un turno para una consulta veterinaria.</p>\n                    \n                    <FormularioTurnoConsulta mascotas={mascotas} />\n                </div>\n            </main>\n            <Footer />\n        </PrivateRoute>\n    );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AAAA;AACA;;;;;;AAIA;AACA;;;;;;;;;AAEA,iEAAiE;AACjE,MAAM,eAAe,CAAC;IACpB,IAAI,CAAC,SAAS,OAAO;IACrB,MAAM,OAAO;QAAE,GAAG,OAAO;IAAC;IAC1B,IAAK,MAAM,OAAO,KAAM;QACtB,IAAI,IAAI,CAAC,IAAI,IAAI,OAAO,IAAI,CAAC,IAAI,CAAC,MAAM,KAAK,YAAY;YACvD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,WAAW;QAC5C;IACF;IACA,OAAO;AACT;AAEA,eAAe,gBAAgB,MAAM;IACjC,IAAI,CAAC,QAAQ,OAAO,EAAE;IAEtB,MAAM,YAAY,sIAAK,CAAC,SAAS;IACjC,IAAI;QACA,MAAM,eAAe,MAAM,UAAU,UAAU,CAAC,SAAS,GAAG,CAAC,QAAQ,UAAU,CAAC,YAAY,OAAO,CAAC,UAAU,OAAO,GAAG;QACxH,IAAI,aAAa,KAAK,EAAE;YACpB,OAAO,EAAE;QACb;QACA,OAAO,aAAa,IAAI,CAAC,GAAG,CAAC,CAAA,MAAO,CAAC;gBAAE,IAAI,IAAI,EAAE;gBAAE,GAAG,aAAa,IAAI,IAAI,GAAG;YAAC,CAAC;IACpF,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,iDAAiD;QAC/D,OAAO,EAAE;IACb;AACJ;AAEe,eAAe;IAC1B,MAAM,gBAAgB,IAAA,0IAAO,IAAG,GAAG,CAAC,cAAc,SAAS;IAC3D,MAAM,SAAS,MAAM,IAAA,mJAAoB,EAAC;IAE1C,IAAI,CAAC,QAAQ;QACT,IAAA,iMAAQ,EAAC;IACb;IAEA,MAAM,WAAW,MAAM,gBAAgB;IAEvC,IAAI,SAAS,MAAM,KAAK,GAAG;QACvB,qBACI,8OAAC,mJAAY;;8BACT,8OAAC;oBAAK,WAAU;8BACZ,cAAA,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;gCAAG,WAAU;0CAAwC;;;;;;0CACtD,8OAAC;gCAAE,WAAU;0CAAqB;;;;;;0CAGlC,8OAAC;gCAAE,MAAK;gCAAkB,WAAU;0CAAmH;;;;;;;;;;;;;;;;;8BAK/J,8OAAC,8IAAM;;;;;;;;;;;IAGnB;IAEA,qBACI,8OAAC,mJAAY;;0BACT,8OAAC;gBAAK,WAAU;0BACZ,cAAA,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;4BAAG,WAAU;sCAAyD;;;;;;sCACvE,8OAAC;4BAAE,WAAU;sCAA0C;;;;;;sCAEvD,8OAAC;4BAAwB,UAAU;;;;;;;;;;;;;;;;;0BAG3C,8OAAC,8IAAM;;;;;;;;;;;AAGnB","debugId":null}}]
}