{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/lib/firebaseConfig.js"],"sourcesContent":["export const firebaseConfig = {\n  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\n  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\n  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\n};"],"names":[],"mappings":";;;;AAAO,MAAM,iBAAiB;IAC5B,MAAM;IACN,UAAU;IACV,SAAS;IACT,aAAa;IACb,iBAAiB;IACjB,KAAK;AACP","debugId":null}},
    {"offset": {"line": 26, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/lib/firebaseAdmin.js"],"sourcesContent":["import admin from 'firebase-admin';\nimport { firebaseConfig } from './firebaseConfig';\n\nconst privateKey = process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g, '\\n');\n\nif (!admin.apps.length) {\n  try {\n    admin.initializeApp({\n      credential: admin.credential.cert({\n        projectId: firebaseConfig.projectId,\n        clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\n        privateKey,\n      }),\n      databaseURL: `https://${firebaseConfig.projectId}.firebaseio.com`\n    });\n  } catch (error) {\n    console.error('Firebase admin initialization error', error);\n  }\n}\n\nexport default admin;"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,oBAAoB,EAAE,QAAQ,OAAO;AAEpE,IAAI,CAAC,sIAAK,CAAC,IAAI,CAAC,MAAM,EAAE;IACtB,IAAI;QACF,sIAAK,CAAC,aAAa,CAAC;YAClB,YAAY,sIAAK,CAAC,UAAU,CAAC,IAAI,CAAC;gBAChC,WAAW,8IAAc,CAAC,SAAS;gBACnC,aAAa,QAAQ,GAAG,CAAC,qBAAqB;gBAC9C;YACF;YACA,aAAa,CAAC,QAAQ,EAAE,8IAAc,CAAC,SAAS,CAAC,eAAe,CAAC;QACnE;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uCAAuC;IACvD;AACF;uCAEe,sIAAK","debugId":null}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/actions.js"],"sourcesContent":["\n'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport admin from '@/lib/firebaseAdmin'; // Usamos el admin SDK\n\n// El \"directorio\" seguro de roles. El DNI es la clave.\nconst aplicationRoles = {\n  '00000001': 'admin',      // Magali - DNI sin puntos\n  '00000002': 'peluquera',\n  '00000003': 'transporte',\n};\n\nexport async function completarPerfil(userId, userData) {\n  // Obtenemos los servicios de Firebase aquí para asegurar la inicialización\n  const firestore = admin.firestore();\n  const auth = admin.auth();\n\n  // Desestructuramos todos los datos del formulario\n  const { dni, phone, direccion, localidad, provincia } = userData;\n  \n  // Actualizamos la validación para incluir los nuevos campos\n  if (!userId || !dni || !phone || !direccion || !localidad || !provincia) {\n    return { success: false, error: 'Faltan datos por completar.' };\n  }\n\n  try {\n    // Determinamos el rol basado en el DNI. Si no está en la lista, es 'cliente'.\n    const userRole = aplicationRoles[dni] || 'cliente';\n\n    // 1. Establecer el Custom Claim para el rol. Esta es la fuente de verdad para la seguridad.\n    await auth.setCustomUserClaims(userId, { role: userRole });\n\n    // 2. Crear o actualizar el documento del usuario en Firestore con todos los datos\n    await firestore.collection('users').doc(userId).set({\n      dni,\n      phone,\n      direccion,\n      localidad,\n      provincia,\n      role: userRole, // Guardamos el rol para facilitar consultas en el frontend\n      profileCompleted: true,\n    }, { merge: true }); // Usamos merge: true para no sobrescribir otros datos existentes\n\n    revalidatePath('/'); // Revalida la caché de Next.js, actualizando la UI (ej. Header)\n    \n    // Devolvemos el rol para que el frontend pueda redirigir correctamente\n    return { success: true, role: userRole };\n\n  } catch (error) {\n    console.error('Error al completar el perfil:', error);\n    // Devolvemos un error genérico para no exponer detalles de implementación\n    return { success: false, error: 'Ocurrió un error en el servidor al procesar tu perfil.' };\n  }\n}\n"],"names":[],"mappings":";;;;;;AAGA;AACA,wNAAyC,sBAAsB;;;;;;AAE/D,uDAAuD;AACvD,MAAM,kBAAkB;IACtB,YAAY;IACZ,YAAY;IACZ,YAAY;AACd;AAEO,eAAe,gBAAgB,MAAM,EAAE,QAAQ;IACpD,2EAA2E;IAC3E,MAAM,YAAY,sIAAK,CAAC,SAAS;IACjC,MAAM,OAAO,sIAAK,CAAC,IAAI;IAEvB,kDAAkD;IAClD,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,GAAG;IAExD,4DAA4D;IAC5D,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,SAAS,CAAC,aAAa,CAAC,aAAa,CAAC,WAAW;QACvE,OAAO;YAAE,SAAS;YAAO,OAAO;QAA8B;IAChE;IAEA,IAAI;QACF,8EAA8E;QAC9E,MAAM,WAAW,eAAe,CAAC,IAAI,IAAI;QAEzC,4FAA4F;QAC5F,MAAM,KAAK,mBAAmB,CAAC,QAAQ;YAAE,MAAM;QAAS;QAExD,kFAAkF;QAClF,MAAM,UAAU,UAAU,CAAC,SAAS,GAAG,CAAC,QAAQ,GAAG,CAAC;YAClD;YACA;YACA;YACA;YACA;YACA,MAAM;YACN,kBAAkB;QACpB,GAAG;YAAE,OAAO;QAAK,IAAI,iEAAiE;QAEtF,IAAA,+IAAc,EAAC,MAAM,gEAAgE;QAErF,uEAAuE;QACvE,OAAO;YAAE,SAAS;YAAM,MAAM;QAAS;IAEzC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,0EAA0E;QAC1E,OAAO;YAAE,SAAS;YAAO,OAAO;QAAyD;IAC3F;AACF;;;IAzCsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 129, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/.next-internal/server/app/completar-perfil/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {completarPerfil as '6091545e0ff3735577794c80d201d16465bc00f7ee'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/completar-perfil/page.js/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/completar-perfil/page.js <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/completar-perfil/page.js <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAoS,GACjU,kEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 176, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/completar-perfil/page.js/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/completar-perfil/page.js from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/completar-perfil/page.js\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAgR,GAC7S,8CACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 190, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}