{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/lib/firebaseAdmin.js"],"sourcesContent":["\nimport admin from 'firebase-admin';\n\n\nif (!admin.apps.length) {\n  try {\n    admin.initializeApp();\n  } catch (error) {\n    console.error('Error en la inicialización de Firebase Admin SDK:', error);\n  }\n}\n\n/**\n * Verifica la cookie de sesión de Firebase y devuelve el UID del usuario.\n * @param {string} sessionCookie La cadena de la cookie de sesión.\n * @returns {Promise<string|null>} El UID del usuario o null si la cookie no es válida.\n */\nexport async function getUserIdFromSession(sessionCookie) {\n  if (!sessionCookie) {\n    return null;\n  }\n  try {\n    const decodedClaims = await admin.auth().verifySessionCookie(sessionCookie, true);\n    return decodedClaims.uid;\n  } catch (error) {\n    console.error('Error al verificar la cookie de sesión:', error.code);\n    return null;\n  }\n}\n\n\nexport default admin;\n"],"names":[],"mappings":";;;;;;AACA;;AAGA,IAAI,CAAC,sIAAK,CAAC,IAAI,CAAC,MAAM,EAAE;IACtB,IAAI;QACF,sIAAK,CAAC,aAAa;IACrB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qDAAqD;IACrE;AACF;AAOO,eAAe,qBAAqB,aAAa;IACtD,IAAI,CAAC,eAAe;QAClB,OAAO;IACT;IACA,IAAI;QACF,MAAM,gBAAgB,MAAM,sIAAK,CAAC,IAAI,GAAG,mBAAmB,CAAC,eAAe;QAC5E,OAAO,cAAc,GAAG;IAC1B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2CAA2C,MAAM,IAAI;QACnE,OAAO;IACT;AACF;uCAGe,sIAAK","debugId":null}},
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/actions.js"],"sourcesContent":["\n'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport admin from '@/lib/firebaseAdmin';\n\nconst aplicationRoles = {\n  '00000001': 'admin',      // Magali - DNI sin puntos\n  '00000002': 'peluquera',\n  '00000003': 'transporte',\n};\n\nexport async function completarPerfil(userId, userData) {\n  const firestore = admin.firestore();\n  const auth = admin.auth();\n\n  // Campos que vienen del formulario de registro\n  const { \n    nombre, \n    apellido, \n    dni, \n    telefonoPrincipal, \n    telefonoSecundario, \n    direccion, \n    barrio, \n    nombreContactoEmergencia, \n    telefonoContactoEmergencia \n  } = userData;\n  \n  // Validación con los campos correctos\n  if (!userId || !nombre || !apellido || !dni || !telefonoPrincipal || !direccion || !barrio || !nombreContactoEmergencia || !telefonoContactoEmergencia) {\n    console.error('Validation failed. Missing data:', { userId, ...userData });\n    return { success: false, error: 'Faltan datos esenciales para completar el perfil.' };\n  }\n\n  try {\n    // Asignar rol. Si el DNI está en la lista, se le da un rol especial.\n    const userRole = aplicationRoles[dni] || 'dueño';\n\n    // 1. Asignar el \"custom claim\" para el rol de usuario en Authentication\n    await auth.setCustomUserClaims(userId, { role: userRole });\n\n    // 2. Guardar todos los datos del perfil en la base de datos Firestore\n    await firestore.collection('users').doc(userId).set({\n      nombre,\n      apellido,\n      dni,\n      telefonoPrincipal,\n      telefonoSecundario: telefonoSecundario || '', // Guardar aunque esté vacío\n      direccion,\n      barrio,\n      nombreContactoEmergencia,\n      telefonoContactoEmergencia,\n      role: userRole,\n      profileCompleted: true,\n      createdAt: admin.firestore.FieldValue.serverTimestamp(), // Buena práctica\n    }, { merge: true }); // Merge true para no sobrescribir datos si ya existía el doc.\n\n    // Invalidar caché para que los cambios se reflejen si es necesario\n    revalidatePath('/');\n    \n    return { success: true, role: userRole };\n\n  } catch (error) {\n    console.error('Error al completar el perfil en el servidor:', error);\n    // Devolver un error genérico para no exponer detalles de implementación\n    return { success: false, error: 'Ocurrió un error en el servidor al procesar tu perfil.' };\n  }\n}\n\n/**\n * Server Action para agregar una nueva mascota a un usuario.\n */\nexport async function agregarMascota(userId, mascotaData) {\n    if (!userId) {\n        return { success: false, error: 'Usuario no autenticado.' };\n    }\n\n    const { nombre, especie, raza, fechaNacimiento, tamaño, enAdopcion } = mascotaData;\n\n    if (!nombre || !especie || !raza || !fechaNacimiento || !tamaño) {\n        return { success: false, error: 'Todos los campos, incluyendo el tamaño, son obligatorios.' };\n    }\n\n    const firestore = admin.firestore();\n\n    try {\n        const mascotaRef = await firestore.collection('users').doc(userId).collection('mascotas').add({\n            nombre,\n            especie,\n            raza,\n            fechaNacimiento,\n            tamaño,\n            enAdopcion: enAdopcion || false, \n            createdAt: new Date(),\n        });\n\n        revalidatePath('/mascotas');\n\n        return { success: true, mascotaId: mascotaRef.id };\n\n    } catch (error) {\n        console.error('Error al agregar la mascota:', error);\n        return { success: false, error: 'No se pudo registrar la mascota en la base de datos.' };\n    }\n}\n"],"names":[],"mappings":";;;;;;;;AAGA;AACA;;;;;;AAEA,MAAM,kBAAkB;IACtB,YAAY;IACZ,YAAY;IACZ,YAAY;AACd;AAEO,eAAe,gBAAgB,MAAM,EAAE,QAAQ;IACpD,MAAM,YAAY,sIAAK,CAAC,SAAS;IACjC,MAAM,OAAO,sIAAK,CAAC,IAAI;IAEvB,+CAA+C;IAC/C,MAAM,EACJ,MAAM,EACN,QAAQ,EACR,GAAG,EACH,iBAAiB,EACjB,kBAAkB,EAClB,SAAS,EACT,MAAM,EACN,wBAAwB,EACxB,0BAA0B,EAC3B,GAAG;IAEJ,sCAAsC;IACtC,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,YAAY,CAAC,OAAO,CAAC,qBAAqB,CAAC,aAAa,CAAC,UAAU,CAAC,4BAA4B,CAAC,4BAA4B;QACtJ,QAAQ,KAAK,CAAC,oCAAoC;YAAE;YAAQ,GAAG,QAAQ;QAAC;QACxE,OAAO;YAAE,SAAS;YAAO,OAAO;QAAoD;IACtF;IAEA,IAAI;QACF,qEAAqE;QACrE,MAAM,WAAW,eAAe,CAAC,IAAI,IAAI;QAEzC,wEAAwE;QACxE,MAAM,KAAK,mBAAmB,CAAC,QAAQ;YAAE,MAAM;QAAS;QAExD,sEAAsE;QACtE,MAAM,UAAU,UAAU,CAAC,SAAS,GAAG,CAAC,QAAQ,GAAG,CAAC;YAClD;YACA;YACA;YACA;YACA,oBAAoB,sBAAsB;YAC1C;YACA;YACA;YACA;YACA,MAAM;YACN,kBAAkB;YAClB,WAAW,sIAAK,CAAC,SAAS,CAAC,UAAU,CAAC,eAAe;QACvD,GAAG;YAAE,OAAO;QAAK,IAAI,8DAA8D;QAEnF,mEAAmE;QACnE,IAAA,+IAAc,EAAC;QAEf,OAAO;YAAE,SAAS;YAAM,MAAM;QAAS;IAEzC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gDAAgD;QAC9D,wEAAwE;QACxE,OAAO;YAAE,SAAS;YAAO,OAAO;QAAyD;IAC3F;AACF;AAKO,eAAe,eAAe,MAAM,EAAE,WAAW;IACpD,IAAI,CAAC,QAAQ;QACT,OAAO;YAAE,SAAS;YAAO,OAAO;QAA0B;IAC9D;IAEA,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,eAAe,EAAE,MAAM,EAAE,UAAU,EAAE,GAAG;IAEvE,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,QAAQ,CAAC,mBAAmB,CAAC,QAAQ;QAC7D,OAAO;YAAE,SAAS;YAAO,OAAO;QAA4D;IAChG;IAEA,MAAM,YAAY,sIAAK,CAAC,SAAS;IAEjC,IAAI;QACA,MAAM,aAAa,MAAM,UAAU,UAAU,CAAC,SAAS,GAAG,CAAC,QAAQ,UAAU,CAAC,YAAY,GAAG,CAAC;YAC1F;YACA;YACA;YACA;YACA;YACA,YAAY,cAAc;YAC1B,WAAW,IAAI;QACnB;QAEA,IAAA,+IAAc,EAAC;QAEf,OAAO;YAAE,SAAS;YAAM,WAAW,WAAW,EAAE;QAAC;IAErD,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO;YAAE,SAAS;YAAO,OAAO;QAAuD;IAC3F;AACJ;;;IA7FsB;IA6DA;;AA7DA,+OAAA;AA6DA,+OAAA","debugId":null}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/.next-internal/server/app/mascotas/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {completarPerfil as '6091545e0ff3735577794c80d201d16465bc00f7ee'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 199, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/mascotas/page.jsx"],"sourcesContent":["\nimport { cookies } from 'next/headers';\nimport admin from '@/lib/firebaseAdmin';\nimport Link from 'next/link';\nimport { FaPlusCircle, FaHeart, FaSignInAlt, FaUserPlus } from 'react-icons/fa';\n\nasync function getUserMascotas(uid) {\n    const firestore = admin.firestore();\n    try {\n        const mascotasSnap = await firestore.collection('users').doc(uid).collection('mascotas').orderBy('createdAt', 'desc').get();\n        if (mascotasSnap.empty) {\n            return [];\n        }\n        return mascotasSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n    } catch (error) {\n        console.error(\"Error al obtener las mascotas:\", error);\n        return []; \n    }\n}\n\nconst MascotaCard = ({ mascota }) => {\n    const fechaNac = new Date(mascota.fechaNacimiento).toLocaleDateString('es-AR');\n\n    return (\n        <div className=\"bg-white rounded-xl shadow-lg overflow-hidden transform hover:-translate-y-1 transition-transform duration-300 relative\">\n            {mascota.enAdopcion && (\n                <div className=\"absolute top-3 right-3 bg-pink-500 text-white text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1\">\n                    <FaHeart />\n                    <span>En Adopción</span>\n                </div>\n            )}\n            <div className=\"p-6\">\n                <h3 className=\"text-2xl font-bold text-gray-800 mb-2\">{mascota.nombre}</h3>\n                <p className=\"text-md text-gray-600\"><span className=\"font-semibold\">Especie:</span> {mascota.especie}</p>\n                <p className=\"text-md text-gray-600\"><span className=\"font-semibold\">Raza:</span> {mascota.raza}</p>\n                <p className=\"text-md text-gray-600\"><span className=\"font-semibold\">Nacimiento:</span> {fechaNac}</p>\n            </div>\n            <div className=\"bg-gray-50 p-4 flex justify-around\">\n                 <Link href={`/mascotas/${mascota.id}/carnet`}>\n                    <span className=\"text-sm font-medium text-violet-600 hover:text-violet-800 transition-colors\">Ver Carnet</span>\n                </Link>\n                <button className=\"text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors\">Editar</button>\n            </div>\n        </div>\n    );\n};\n\n// Componente para usuarios no autenticados\nconst UnauthorizedView = () => (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8\">\n        <div className=\"max-w-lg w-full text-center bg-white p-12 rounded-2xl shadow-xl border border-gray-100\">\n            <h2 className=\"text-3xl font-extrabold text-gray-900 mb-4\">Acceso Restringido</h2>\n            <p className=\"mt-4 text-lg text-gray-600\">\n                Por favor, inicia sesión para poder ver y gestionar tus mascotas.\n            </p>\n            <div className=\"mt-8 flex flex-col sm:flex-row sm:justify-center gap-4\">\n                <Link href=\"/login\">\n                    <span className=\"w-full inline-flex justify-center items-center gap-2 bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 px-5 rounded-full transition-transform duration-300 transform hover:scale-105 shadow-lg\">\n                        <FaSignInAlt />\n                        Iniciar Sesión\n                    </span>\n                </Link>\n                <Link href=\"/registro\">\n                     <span className=\"w-full inline-flex justify-center items-center gap-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-5 rounded-full transition-transform duration-300 transform hover:scale-105\">\n                        <FaUserPlus />\n                        Crear Cuenta\n                    </span>\n                </Link>\n            </div>\n        </div>\n    </div>\n);\n\n\n\n\nexport default async function MisMascotasPage() {\n    const cookieStore = cookies();\n\n    const sessionCookie = cookieStore.get('__session');\n\n    if (!sessionCookie) {\n        return <UnauthorizedView />;\n    }\n\n    let uid;\n    try {\n        const decodedClaims = await admin.auth().verifySessionCookie(sessionCookie.value, true);\n        uid = decodedClaims.uid;\n    } catch (error) {\n        console.error(\"Error de autenticación de sesión:\", error);\n        return <UnauthorizedView />;\n    }\n\n    const mascotas = uid ? await getUserMascotas(uid) : [];\n\n    return (\n        <div className=\"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\n            <div className=\"max-w-7xl mx-auto\">\n                <div className=\"flex justify-between items-center mb-10\">\n                    <h1 className=\"text-4xl font-extrabold text-gray-900\">Mis Mascotas</h1>\n                    <Link href=\"/mascotas/nueva\">\n                        <span className=\"inline-flex items-center gap-2 bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 px-5 rounded-full transition-transform duration-300 transform hover:scale-105 shadow-lg\">\n                            <FaPlusCircle />\n                            Añadir Mascota\n                        </span>\n                    </Link>\n                </div>\n\n                {mascotas.length > 0 ? (\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                        {mascotas.map(mascota => (\n                            <MascotaCard key={mascota.id} mascota={mascota} />\n                        ))}\n                    </div>\n                ) : (\n                    <div className=\"text-center bg-white p-12 rounded-2xl shadow-md\">\n                        <h3 className=\"text-2xl font-semibold text-gray-800\">Aún no tienes mascotas registradas</h3>\n                        <p className=\"mt-4 text-gray-600\">¡No esperes más! Añade a tu primer compañero para llevar un registro de su salud y turnos.</p>\n                        <div className=\"mt-8\">\n                            <Link href=\"/mascotas/nueva\">\n                                <span className=\"bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 px-6 rounded-full transition-transform duration-300 transform hover:scale-105 shadow-lg\">\n                                    Registrar mi Primera Mascota\n                                </span>\n                            </Link>\n                        </div>\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}