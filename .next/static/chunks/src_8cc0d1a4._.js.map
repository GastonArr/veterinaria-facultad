{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/lib/firebaseConfig.js"],"sourcesContent":["export const firebaseConfig = {\n  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\n  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\n  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\n};"],"names":[],"mappings":";;;;AACU;AADH,MAAM,iBAAiB;IAC5B,MAAM;IACN,UAAU;IACV,SAAS;IACT,aAAa;IACb,iBAAiB;IACjB,KAAK;AACP","debugId":null}},
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/lib/firebase.js"],"sourcesContent":["import { initializeApp, getApps, getApp } from 'firebase/app';\nimport { getFirestore } from 'firebase/firestore';\nimport { getAuth } from 'firebase/auth';\nimport { firebaseConfig } from './firebaseConfig';\n\nconst app = !getApps().length ? initializeApp(firebaseConfig) : getApp();\nconst db = getFirestore(app);\nconst auth = getAuth(app);\n\nexport { app, db, auth };"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;;;;;AAEA,MAAM,MAAM,CAAC,IAAA,8KAAO,IAAG,MAAM,GAAG,IAAA,oLAAa,EAAC,iJAAc,IAAI,IAAA,6KAAM;AACtE,MAAM,KAAK,IAAA,kLAAY,EAAC;AACxB,MAAM,OAAO,IAAA,wKAAO,EAAC","debugId":null}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/contexts/AuthContext.js"],"sourcesContent":["'use client';\n\nimport { createContext, useContext, useEffect, useState } from 'react';\nimport {\n    onAuthStateChanged,\n    GoogleAuthProvider,\n    signInWithPopup,\n    signOut as firebaseSignOut, // Renombrado para evitar conflicto\n    signInWithEmailAndPassword,\n    createUserWithEmailAndPassword,\n    sendPasswordResetEmail,\n    updatePassword,\n    EmailAuthProvider,\n    reauthenticateWithCredential\n} from 'firebase/auth';\nimport { auth } from '@/lib/firebase';\nimport { useRouter } from 'next/navigation';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n    const [user, setUser] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const router = useRouter();\n\n    useEffect(() => {\n        const unsubscribe = onAuthStateChanged(auth, async (user) => {\n            setUser(user);\n            setLoading(false);\n            // Sincronizar la cookie de sesión cada vez que el estado de autenticación cambie\n            if (user) {\n                const idToken = await user.getIdToken();\n                // Llamada a nuestra API para crear la cookie\n                await fetch('/api/auth/session', {\n                    method: 'POST',\n                    headers: {\n                        'Authorization': `Bearer ${idToken}`,\n                    },\n                });\n            } else {\n                // Llamada a nuestra API para borrar la cookie\n                await fetch('/api/auth/session', {\n                    method: 'DELETE',\n                });\n            }\n        });\n\n        return () => unsubscribe();\n    }, []);\n\n    const loginWithGoogle = async () => {\n        const provider = new GoogleAuthProvider();\n        // El manejo del token y la cookie ya se hace en onAuthStateChanged\n        return signInWithPopup(auth, provider);\n    };\n\n    const loginWithEmail = async (email, password) => {\n        // El manejo del token y la cookie ya se hace en onAuthStateChanged\n        return signInWithEmailAndPassword(auth, email, password);\n    };\n\n    const registerWithEmailAndPassword = async (email, password) => {\n        // El manejo del token y la cookie ya se hace en onAuthStateChanged\n        return createUserWithEmailAndPassword(auth, email, password);\n    };\n    \n    const signOut = async () => {\n        // El manejo para borrar la cookie ya se hace en onAuthStateChanged\n        return firebaseSignOut(auth);\n    };\n\n    const resetPassword = (email) => {\n        return sendPasswordResetEmail(auth, email);\n    };\n\n    const reauthenticate = async (currentPassword) => {\n        const credential = EmailAuthProvider.credential(user.email, currentPassword);\n        return reauthenticateWithCredential(user, credential);\n    };\n\n    const changePassword = (newPassword) => {\n        return updatePassword(user, newPassword);\n    };\n\n\n    const value = {\n        user,\n        loading,\n        loginWithGoogle,\n        loginWithEmail,\n        registerWithEmailAndPassword,\n        signOut,\n        resetPassword,\n        reauthenticate,\n        changePassword,\n        // No se necesita el rol aquí, se obtendrá en el servidor\n    };\n\n    return (\n        <AuthContext.Provider value={value}>\n            {!loading && children}\n        </AuthContext.Provider>\n    );\n};\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAAA;AAYA;AACA;;;AAhBA;;;;;AAkBA,MAAM,4BAAc,IAAA,8KAAa;AAE1B,MAAM,UAAU;;IAAM,OAAA,IAAA,2KAAU,EAAC;AAAW;GAAtC;AAEN,MAAM,eAAe;QAAC,EAAE,QAAQ,EAAE;;IACrC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,SAAS,IAAA,kJAAS;IAExB,IAAA,0KAAS;kCAAC;YACN,MAAM,cAAc,IAAA,mLAAkB,EAAC,iIAAI;sDAAE,OAAO;oBAChD,QAAQ;oBACR,WAAW;oBACX,iFAAiF;oBACjF,IAAI,MAAM;wBACN,MAAM,UAAU,MAAM,KAAK,UAAU;wBACrC,6CAA6C;wBAC7C,MAAM,MAAM,qBAAqB;4BAC7B,QAAQ;4BACR,SAAS;gCACL,iBAAiB,AAAC,UAAiB,OAAR;4BAC/B;wBACJ;oBACJ,OAAO;wBACH,8CAA8C;wBAC9C,MAAM,MAAM,qBAAqB;4BAC7B,QAAQ;wBACZ;oBACJ;gBACJ;;YAEA;0CAAO,IAAM;;QACjB;iCAAG,EAAE;IAEL,MAAM,kBAAkB;QACpB,MAAM,WAAW,IAAI,mLAAkB;QACvC,mEAAmE;QACnE,OAAO,IAAA,gLAAe,EAAC,iIAAI,EAAE;IACjC;IAEA,MAAM,iBAAiB,OAAO,OAAO;QACjC,mEAAmE;QACnE,OAAO,IAAA,2LAA0B,EAAC,iIAAI,EAAE,OAAO;IACnD;IAEA,MAAM,+BAA+B,OAAO,OAAO;QAC/C,mEAAmE;QACnE,OAAO,IAAA,+LAA8B,EAAC,iIAAI,EAAE,OAAO;IACvD;IAEA,MAAM,UAAU;QACZ,mEAAmE;QACnE,OAAO,IAAA,wKAAe,EAAC,iIAAI;IAC/B;IAEA,MAAM,gBAAgB,CAAC;QACnB,OAAO,IAAA,uLAAsB,EAAC,iIAAI,EAAE;IACxC;IAEA,MAAM,iBAAiB,OAAO;QAC1B,MAAM,aAAa,kLAAiB,CAAC,UAAU,CAAC,KAAK,KAAK,EAAE;QAC5D,OAAO,IAAA,6LAA4B,EAAC,MAAM;IAC9C;IAEA,MAAM,iBAAiB,CAAC;QACpB,OAAO,IAAA,+KAAc,EAAC,MAAM;IAChC;IAGA,MAAM,QAAQ;QACV;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IAEJ;IAEA,qBACI,6LAAC,YAAY,QAAQ;QAAC,OAAO;kBACxB,CAAC,WAAW;;;;;;AAGzB;IAnFa;;QAGM,kJAAS;;;KAHf","debugId":null}},
    {"offset": {"line": 176, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/Header.jsx"],"sourcesContent":["'use client';\n\nimport { useAuth } from '@/contexts/AuthContext';\nimport Link from 'next/link';\nimport Image from 'next/image';\n\n// Función para obtener iniciales para el avatar de fallback\nconst getInitials = (name) => {\n  if (!name) return '?';\n  const names = name.split(' ');\n  if (names.length === 1) return names[0].charAt(0).toUpperCase();\n  return (names[0].charAt(0) + names[names.length - 1].charAt(0)).toUpperCase();\n};\n\n// 1. EL COMPONENTE AHORA RECIBE `userData` COMO PROP\nexport default function Header({ userData }) {\n    // 2. USAMOS `useAuth` ÚNICAMENTE PARA LA FUNCIÓN DE LOGOUT\n    const { logout } = useAuth(); \n    \n    // El nombre de usuario se extrae de las props\n    const displayName = userData?.name ? userData.name.split(' ')[0] : 'Usuario';\n\n    return (\n        <header className=\"bg-white shadow-sm sticky top-0 z-50 w-full\">\n            <nav className=\"max-w-screen-xl mx-auto px-6 lg:px-8\">\n                <div className=\"flex items-center justify-between h-24\">\n                    \n                    <div className=\"flex-shrink-0\">\n                        <Link href=\"/\">\n                            <Image \n                                src=\"/LOGO.svg\" \n                                alt=\"Logo de Veterinaria Magali Martin\"\n                                width={200}\n                                height={55}\n                                priority\n                            />\n                        </Link>\n                    </div>\n\n                    <div className=\"flex-grow\"></div>\n\n                    <div className=\"flex items-center gap-4 min-w-[250px] justify-end\">\n                        {/* 3. LA LÓGICA SE BASA EN `userData.isLoggedIn` */}\n                        {userData.isLoggedIn ? (\n                            <div className=\"flex items-center gap-4\">\n                                <span className=\"hidden lg:inline text-md font-medium text-gray-700\">Hola, {displayName}</span>\n                                <div className=\"flex items-center justify-center bg-violet-100 rounded-full h-14 w-14 text-violet-700 font-bold text-xl overflow-hidden\">\n                                    {/* 4. SE USA `userData.photoURL` Y `userData.name` */}\n                                    {userData.photoURL ? (\n                                        <Image src={userData.photoURL} alt=\"Avatar del usuario\" width={56} height={56} />\n                                    ) : (\n                                        <span>{getInitials(userData.name)}</span>\n                                    )}\n                                </div>\n                                <button onClick={logout} className=\"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-5 rounded-lg transition-colors text-base\">\n                                    Logout\n                                </button>\n                            </div>\n                        ) : (\n                            <Link href=\"/login\">\n                                <span className=\"bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 px-6 rounded-lg transition-colors text-base\">Iniciar Sesión</span>\n                            </Link>\n                        )}\n                    </div>\n                </div>\n            </nav>\n        </header>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;AAJA;;;;AAMA,4DAA4D;AAC5D,MAAM,cAAc,CAAC;IACnB,IAAI,CAAC,MAAM,OAAO;IAClB,MAAM,QAAQ,KAAK,KAAK,CAAC;IACzB,IAAI,MAAM,MAAM,KAAK,GAAG,OAAO,KAAK,CAAC,EAAE,CAAC,MAAM,CAAC,GAAG,WAAW;IAC7D,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,MAAM,CAAC,KAAK,KAAK,CAAC,MAAM,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC,EAAE,EAAE,WAAW;AAC7E;AAGe,SAAS,OAAO,KAAY;QAAZ,EAAE,QAAQ,EAAE,GAAZ;;IAC3B,2DAA2D;IAC3D,MAAM,EAAE,MAAM,EAAE,GAAG,IAAA,4IAAO;IAE1B,8CAA8C;IAC9C,MAAM,cAAc,CAAA,qBAAA,+BAAA,SAAU,IAAI,IAAG,SAAS,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG;IAEnE,qBACI,6LAAC;QAAO,WAAU;kBACd,cAAA,6LAAC;YAAI,WAAU;sBACX,cAAA,6LAAC;gBAAI,WAAU;;kCAEX,6LAAC;wBAAI,WAAU;kCACX,cAAA,6LAAC,0KAAI;4BAAC,MAAK;sCACP,cAAA,6LAAC,2IAAK;gCACF,KAAI;gCACJ,KAAI;gCACJ,OAAO;gCACP,QAAQ;gCACR,QAAQ;;;;;;;;;;;;;;;;kCAKpB,6LAAC;wBAAI,WAAU;;;;;;kCAEf,6LAAC;wBAAI,WAAU;kCAEV,SAAS,UAAU,iBAChB,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAK,WAAU;;wCAAqD;wCAAO;;;;;;;8CAC5E,6LAAC;oCAAI,WAAU;8CAEV,SAAS,QAAQ,iBACd,6LAAC,2IAAK;wCAAC,KAAK,SAAS,QAAQ;wCAAE,KAAI;wCAAqB,OAAO;wCAAI,QAAQ;;;;;6DAE3E,6LAAC;kDAAM,YAAY,SAAS,IAAI;;;;;;;;;;;8CAGxC,6LAAC;oCAAO,SAAS;oCAAQ,WAAU;8CAAoG;;;;;;;;;;;iDAK3I,6LAAC,0KAAI;4BAAC,MAAK;sCACP,cAAA,6LAAC;gCAAK,WAAU;0CAA0G;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ1J;GArDwB;;QAED,4IAAO;;;KAFN","debugId":null}},
    {"offset": {"line": 348, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/app/components/SubHeader.jsx"],"sourcesContent":["'use client';\n\nimport { useAuth } from '@/contexts/AuthContext';\nimport Link from 'next/link';\nimport { usePathname } from 'next/navigation';\n\nexport default function SubHeader() {\n    const { user, loading } = useAuth();\n    const pathname = usePathname();\n\n    if (loading || !user) {\n        return null;\n    }\n\n    // Estilo base para los enlaces\n    const baseStyle = \"text-md font-semibold text-gray-600 hover:text-violet-800 transition-colors duration-200 pb-1\";\n    // Estilo para el enlace activo, con un borde inferior\n    const activeStyle = \"text-md font-semibold text-violet-800 border-b-2 border-violet-800 transition-colors duration-200 pb-1\";\n\n    return (\n        <nav className=\"bg-white shadow-md border-t border-gray-200 w-full sticky top-24 z-40\">\n            <div className=\"max-w-screen-xl mx-auto px-6 lg:px-8\">\n                <div className=\"flex items-center justify-center h-16 gap-x-8 md:gap-x-12\">\n                    {/* 1. BOTÓN PARA VOLVER AL ORIGEN (INICIO/DASHBOARD) */}\n                    <Link href=\"/\">\n                        <span className={pathname === '/' ? activeStyle : baseStyle}>\n                            Inicio\n                        </span>\n                    </Link>\n\n                    <Link href=\"/mis-datos\">\n                        <span className={pathname === '/mis-datos' ? activeStyle : baseStyle}>\n                            Mis Datos\n                        </span>\n                    </Link>\n                    <Link href=\"/mascotas\">\n                       <span className={pathname === '/mascotas' ? activeStyle : baseStyle}>\n                            Mis Mascotas\n                       </span>\n                    </Link>\n                    <Link href=\"/mis-turnos\">\n                        <span className={pathname === '/mis-turnos' ? activeStyle : baseStyle}>\n                            Mis Turnos\n                        </span>\n                    </Link>\n                </div>\n            </div>\n        </nav>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;AAJA;;;;AAMe,SAAS;;IACpB,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,IAAA,4IAAO;IACjC,MAAM,WAAW,IAAA,oJAAW;IAE5B,IAAI,WAAW,CAAC,MAAM;QAClB,OAAO;IACX;IAEA,+BAA+B;IAC/B,MAAM,YAAY;IAClB,sDAAsD;IACtD,MAAM,cAAc;IAEpB,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC;YAAI,WAAU;sBACX,cAAA,6LAAC;gBAAI,WAAU;;kCAEX,6LAAC,0KAAI;wBAAC,MAAK;kCACP,cAAA,6LAAC;4BAAK,WAAW,aAAa,MAAM,cAAc;sCAAW;;;;;;;;;;;kCAKjE,6LAAC,0KAAI;wBAAC,MAAK;kCACP,cAAA,6LAAC;4BAAK,WAAW,aAAa,eAAe,cAAc;sCAAW;;;;;;;;;;;kCAI1E,6LAAC,0KAAI;wBAAC,MAAK;kCACR,cAAA,6LAAC;4BAAK,WAAW,aAAa,cAAc,cAAc;sCAAW;;;;;;;;;;;kCAIxE,6LAAC,0KAAI;wBAAC,MAAK;kCACP,cAAA,6LAAC;4BAAK,WAAW,aAAa,gBAAgB,cAAc;sCAAW;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ/F;GA3CwB;;QACM,4IAAO;QAChB,oJAAW;;;KAFR","debugId":null}},
    {"offset": {"line": 473, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/lib/firebaseAdmin.js"],"sourcesContent":["// Historia de Usuario 5: Gestión de Roles de Usuario\n\nimport admin from 'firebase-admin';\n\n// Comprobación para asegurar que el código se ejecuta solo en el servidor.\nif (typeof window === 'undefined') {\n  if (!admin.apps.length) {\n    try {\n      // Para que el Admin SDK funcione en Vercel, necesita las credenciales de la cuenta de servicio.\n      // Estas deben ser almacenadas como una variable de entorno en el proyecto de Vercel.\n      const serviceAccount = JSON.parse(process.env.FIREBASE_SERVICE_ACCOUNT_KEY);\n\n      admin.initializeApp({\n        credential: admin.credential.cert(serviceAccount)\n      });\n\n      console.log('Firebase Admin SDK inicializado correctamente.');\n\n    } catch (error) {\n      // Este error es común si la variable de entorno no está configurada en Vercel.\n      console.error('ERROR AL INICIALIZAR FIREBASE ADMIN SDK:', error);\n      console.error('Asegúrate de haber configurado la variable de entorno FIREBASE_SERVICE_ACCOUNT_KEY en Vercel con el JSON de tu cuenta de servicio.');\n    }\n  }\n}\n\n/**\n * Verifica la cookie de sesión de Firebase y devuelve el UID del usuario.\n * @param {string} sessionCookie La cadena de la cookie de sesión.\n * @returns {Promise<string|null>} El UID del usuario o null si la cookie no es válida.\n */\nexport async function getUserIdFromSession(sessionCookie) {\n  if (!sessionCookie) {\n    return null;\n  }\n  try {\n    const decodedClaims = await admin.auth().verifySessionCookie(sessionCookie, false);\n    return decodedClaims.uid;\n  } catch (error) {\n    // Si el SDK no se inicializó, este error puede ocurrir.\n    if (error.code === 'auth/invalid-session-cookie') {\n         console.error(\"La cookie de sesión no es válida. Puede que haya expirado o el SDK de Admin no esté configurado correctamente.\")\n    } else {\n        console.error('Error al verificar la cookie de sesión:', error.code);\n    }\n    return null;\n  }\n}\n\n\nexport default admin;\n"],"names":[],"mappings":"AAAA,qDAAqD;;;;;;;AAErD;;AAEA,2EAA2E;AAC3E;;AA0BO,eAAe,qBAAqB,aAAa;IACtD,IAAI,CAAC,eAAe;QAClB,OAAO;IACT;IACA,IAAI;QACF,MAAM,gBAAgB,MAAM,+JAAK,CAAC,IAAI,GAAG,mBAAmB,CAAC,eAAe;QAC5E,OAAO,cAAc,GAAG;IAC1B,EAAE,OAAO,OAAO;QACd,wDAAwD;QACxD,IAAI,MAAM,IAAI,KAAK,+BAA+B;YAC7C,QAAQ,KAAK,CAAC;QACnB,OAAO;YACH,QAAQ,KAAK,CAAC,2CAA2C,MAAM,IAAI;QACvE;QACA,OAAO;IACT;AACF;uCAGe,+JAAK","debugId":null}},
    {"offset": {"line": 510, "column": 0}, "map": {"version":3,"sources":["file:///home/user/veterinariamagali/src/lib/session.js"],"sourcesContent":["'use client';\nimport { cookies } from 'next/headers';\nimport admin from './firebaseAdmin';\n\n/**\n * @name getCurrentUser\n * @description Obtiene el usuario actual desde la cookie de sesión en el servidor.\n * Esta función solo debe ser usada en Componentes de Servidor o Rutas de API.\n * @returns {Promise<import('firebase-admin/auth').DecodedIdToken | null>} El token decodificado del usuario o null si no hay sesión.\n */\nexport async function getCurrentUser() {\n  // CORRECCIÓN FINAL: Se busca la cookie 'session', no '__session'\n  const sessionCookie = (await cookies().get('session'))?.value || '';\n\n  // Si no hay cookie, no hay usuario.\n  if (!sessionCookie) {\n    return null;\n  }\n\n  try {\n    // Se verifica la cookie de sesión con Firebase Admin.\n    const decodedClaims = await admin.auth().verifySessionCookie(sessionCookie, true);\n    return decodedClaims;\n  } catch (error) {\n    // La cookie no es válida (expiró, fue revocada, etc.)\n    console.error('Error verifying session cookie (puede ser normal si la cookie expiró):', error.code);\n    return null;\n  }\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AAFA;;;AAUO,eAAe;QAEE;IADtB,iEAAiE;IACjE,MAAM,gBAAgB,EAAA,QAAC,MAAM,IAAA,6IAAO,IAAG,GAAG,CAAC,wBAArB,4BAAA,MAAkC,KAAK,KAAI;IAEjE,oCAAoC;IACpC,IAAI,CAAC,eAAe;QAClB,OAAO;IACT;IAEA,IAAI;QACF,sDAAsD;QACtD,MAAM,gBAAgB,MAAM,yIAAK,CAAC,IAAI,GAAG,mBAAmB,CAAC,eAAe;QAC5E,OAAO;IACT,EAAE,OAAO,OAAO;QACd,sDAAsD;QACtD,QAAQ,KAAK,CAAC,0EAA0E,MAAM,IAAI;QAClG,OAAO;IACT;AACF","debugId":null}}]
}